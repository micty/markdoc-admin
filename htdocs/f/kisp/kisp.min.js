!function(e,t,n,r,i,o,a,s,l,u,c,f,d,p,v,h,g,m,y,w,b,x,S,k,I,C,j){var q=function(e){function t(e){var t=this,r=(e=S.assign({seperator:"/",repeated:!1,cross:!1,Emitter:null,require:function(e){return t.require(e,!a.cross)}},e)).require;r.new=function(e){var t=r(e);if("function"!=typeof t)return null;var n=[].slice.call(arguments,1);return n=[null].concat(n),new(t.bind.apply(t,n))};var i=e.Emitter,o=i?new i(this):null,a={id$module:{},seperator:e.seperator,repeated:e.repeated,cross:e.cross,require:e.require,Emitter:i,emitter:o};n.set(this,a),this.on("require",function(e,t,n){var r=a.id$module,i=r[e],o=i.emitter;if(o&&o.fire("require",[n]),t){var s=t.name;s!=e&&(o=(i=r[t.parent.id]).emitter)&&o.fire("require",s,[n])}})}var n=new w;return t.prototype={constructor:t,define:function(e,t){var r=n.get(this),i=r.id$module;if(!r.repeated&&i[e])throw new g('配置设定了不允许定义重复的模块: 已存在名为 "'+e+'" 的模块');var o=r.Emitter,a=o?new o(this):null;a&&(a.id="emitter-"+e),i[e]={factory:t,exports:null,required:!1,count:0,mod:null,emitter:a}},require:function(t,r){if("string"!=typeof t)throw new g("参数 id 的类型必须为 string: "+typeof t);var i=n.get(this),o=i.seperator;if(r&&t.includes(o))throw new g("参数明确指定了不允许跨级加载模块: "+t);var a=i.id$module,s=a[t];if(s){if(s.count++,s.required)return s.exports;var l=i.emitter;s.required=!0;var u=s.factory;if("function"!=typeof u)return s.exports=u,l&&l.fire("require",[t,null,u]),u;var c={},f=null,d=t.split(o);d.length>1&&(f=a[d.slice(0,-1).join(o)]);var p=s.mod=new e({id:t,seperator:o,exports:c,module:s,parent:f,mm:this});return(c=u(i.require,p,c))===j&&(c=p.exports),s.exports=c,l&&l.fire("require",[t,p,c]),c}},on:function(e,t){var r=n.get(this).emitter,i=p.from(arguments);r&&r.on(i)},destroy:function(){n.delete(this)}},t}(function(){function e(e){var n=e.id,r=e.module,i=e.seperator,o=e.parent;S.assign(this,{id:n,name:n.split(i).slice(-1)[0],seperator:i,exports:e.exports,count:r.count,parent:o?o.mod:null});var a={id:n,seperator:i,emitter:r.emitter,mm:e.mm};t.set(this,a)}var t=new w;return e.prototype={constructor:e,require:function(e){var n=t.get(this),r=n.seperator;if(e.includes(r))throw new g("不允许跨级加载模块: "+e);var i=n.id+r+e;return n.mm.require(i)},on:function(){var e=t.get(this).emitter;e&&e.on(...arguments)},bind:function(e,t){var n=this,r={};"string"==typeof e?r[e]=t:r=e,S.keys(r).forEach(function(e){var t=r[e],i="function"==typeof t?t:function(e){e.on(t)};n.on("require",e,i)})},load:function(e,n,r){"function"==typeof n&&(r=n,n=null);var i=this.require(e);if(i)r&&r(i);else{var o=this,a=t.get(this),s=a.id+a.seperator+e;E.require("Package").load(s,function(t){var i=t.html;n&&i&&i.content&&E.require("$")(n).append(i.content);var a=o.require(e);if(!a)throw new g("不存在名为 "+e+" 的子模块");r&&r(a)})}},render:function(e,t,n,r){var i=[].slice.call(arguments,1),o=this.require(e);if(!o)throw new g("不存在名为 "+e+" 的子模块。");return o.render.apply(o,i),o}},e}()),E=function(e){var t=new e({cross:!0}),n={};return{define:t.define.bind(t),require:t.require.bind(t),bind:function(e,n,r){return function(){var i=t.require(e),o=p.from(arguments);return r=!0===r?i:r,r=r||null,i[n].apply(r,o)}},expose:function(e,t){if(p.isArray(e))e.forEach(function(e){n[e]=!0});else{if("object"!=typeof e)return 2!=arguments.length||(n[e]=t);var r=e;S.keys(r).forEach(function(e){n[e]=r[e]})}}}}(q),A=E.define;A("KISP",function(e,t,n){t.exports={name:"pc",version:"0.0.1",edition:"min",require:function(t){return E.expose(t)?e(t):null},create:e.new,config:E.bind("Defaults","config"),data:E.bind("Defaults","data"),route:E.bind("Router","set"),proxy:E.bind("Proxy","response"),launch:E.bind("App","launch"),alert:E.bind("Alert","show"),confirm:E.bind("Confirm","show"),view:E.bind("View","define"),panel:E.bind("Panel","define")}}),A("Defaults",function(e,t,n){function r(t){if(!s[t]){var n=e(t+".defaults"),r=e(t+".config"),a=i.extendDeeply({},n,r);(o=o||e.new("Config")).set(t,a),s[t]=!0}}var i=e("Object"),o=null,a=null,s={};t.exports=n={set:function(e,t){"object"==typeof e?i.each(e,function(e,t){r(e),o.set(e,t)}):(r(e),o.set(e,t))},get:function(e){return r(e),o.get(e)},clone:function(e,t,r,o){var a=n.get(e),s=[].slice.call(arguments,1);return s=[{},a].concat(s),i.extendDeeply.apply(null,s)},config:function(e,t){if(1==arguments.length&&"string"==typeof e)return n.get(e);n.set(e,t)},data:function(t,n){if(a=a||e.new("Config"),1==arguments.length&&"string"==typeof t)return a.get(t);a.set(t,n)}}}),A("Config",function(e,t,n){function r(){var e={name$data:{}};o.set(this,e)}var i=e("Object"),o=new w;return r.prototype={constructor:r,set:function(e,t){function n(e,t){if(e in r){var n=r[e];i.isPlain(n)?i.extendDeeply(n,t):r[e]=t}else r[e]=t}var r=o.get(this).name$data;"object"==typeof e?i.each(e,function(e,t){n(e,t)}):n(e,t)},get:function(e){return o.get(this).name$data[e]},clone:function(e,t,n,r){var o=this.get(e),a=[].slice.call(arguments,1);return a=[{},o].concat(a),i.extendDeeply.apply(null,a)}},r}),A("Object",function(e,t,n){t.exports=n={extend:S.assign,extendDeeply:function(e,t,r){function i(e,t){e=e||{};for(var n in t){var r=t[n],a=e[n];o(r)&&(r=i(a=o(a)?i({},a):{},r)),e[n]=r}return e}var o=n.isPlain;t&&"object"==typeof t&&(e=i(e,t)),r&&"object"==typeof r&&(e=i(e,r));var a=arguments.length;if(3>=a)return e;for(var s=3;s<a;s++)e=i(e,arguments[s]);return e},isEmpty:function(e){for(var t in e)return!1;return!0},isPlain:function(e){if(!e||"object"!=typeof e)return!1;var t=S.prototype.hasOwnProperty,n=e.constructor;try{if(n&&!t.call(e,"constructor")&&!t.call(n.prototype,"isPrototypeOf"))return!1}catch(e){return!1}var r;for(r in e);return r===j||t.call(e,r)},flat:function(e){function t(e,n){for(var a in e){var s=e[a];(o=o.slice(0,n)).push(a),r(s)?t(s,n+1):i.push({keys:o,value:s})}}var r=n.isPlain,i=[];if(!e||!r(e))return i;var o=[];return t(e,0),i},each:function(e,t,n){var r=arguments.callee;for(var i in e){var o=e[i];if(!1===t(i,o))break;!0===n&&o&&"object"==typeof o&&r(o,t,!0)}},map:function(e,t,r){var i=arguments.callee,o=n.isPlain,a={};for(var s in e){var l=e[s];r&&o(l)?a[s]=i(l,t,r):a[s]=t(s,l)}return a},make:function(e,t){var n={};return p.isArray(e)?p.from(arguments).forEach(function(e,t){n[e[0]]=e[1]}):n[e]=t,n},filter:function(t,r){e("Array");var i={};if(p.isArray(r))r.forEach(function(e,n){e in t&&(i[e]=t[e])});else if(n.isPlain(r))n.each(r,function(e,n){e in t&&(i[e]=t[e])});else{if("string"!=typeof r)throw new g("无法识别参数 samples 的类型");var o=r;o in t&&(i[o]=t[o])}return i},remove:function(e,t){var n=S.assign({},e);if("string"==typeof t)delete n[t];else if(p.isArray(t))for(var r=0,i=t.length;r<i;r++)delete n[t[r]];else for(var o in t)delete n[o];return n}}}),A("Array",function(e,t,n){t.exports=n={each:function(e,t,n){for(var r=arguments.callee,i=0,o=e.length;i<o;i++){var a=e[i];if(n&&a instanceof p)r(a,t,!0);else if(!1===t(a,i))break}return e},map:function(e,t,n){for(var r,i=arguments.callee,o=[],a=0,s=e.length;a<s;a++){var l=e[a];if(n&&l instanceof p)r=i(l,t,!0);else{if(null===(r=t(l,a)))continue;if(r===j)break}o.push(r)}return o},keep:function(e,t,n){for(var r=arguments.callee,i=[],o=0,a=e.length;o<a;o++){var s=e[o],l=n&&s instanceof p?r(s,t,!0):t(s,o);i.push(l)}return i},grep:function(e,t,n){for(var r=arguments.callee,i=[],o=0,a=e.length;o<a;o++){var s=e[o];n&&s instanceof p?(s=r(s,t,!0),i.push(s)):!0===t(s,o)&&i.push(s)}return i},slide:function(e,t,n){if(t>=e.length)return[e];n=n||1;for(var r=[],i=0,o=e.length;i<o;i+=n){var a=i+t;if(r.push(e.slice(i,a)),a>=o)break}return r},group:function(e,t,r){var i=n.slide(e,t,t);return!0===r&&(i[i.length-1]=e.slice(-t)),i},sum:function(e,t,r){var i=0;if("function"==typeof t){var o=t;return n.each(e,function(e,t){var n=o(e,t);if("number"!=typeof n)throw new g("第 "+t+" 个元素的返回值不是数字");i+=n}),i}for(var a=!(r===j),s=0,l=e.length;s<l;s++){var u=a?e[s][r]:e[s];if(isNaN(u)){if(!0===t)continue;throw new g("第 "+s+" 个元素的值为 NaN")}i+=x(u)}return i},pad:function(e,t,n,r){if(e==t)return[];"function"==typeof n?(r=n,n=1):n=b.abs(n||1);var i=[],o=0;if(e<t)for(a=e;a<t;a+=n){s=r?r(a,o):a;i.push(s),o++}else for(var a=e;a>t;a-=n){var s=r?r(a,o):a;i.push(s),o++}return i}}}),A("Router",function(e,t,n){var r={};return{set:function(e,t){if(r[e])throw new g("重复定义路由器: "+e);r[e]=t},get:function(e,t,n){var i={};for(var o in r){var a=r[o];"function"==typeof a&&(a=a(e,t,n)),i[o]=a}return i}}}),A("Proxy",function(e,t,n){function r(e){var n=s.get(t.id).delay,r=[].slice.call(arguments,1);l.delay(n,e,r)}function i(n,r){var i=t.require("Url").get(n);e("Script").load(i,function(){var e=u;u=null,"function"==typeof e&&(e=e(r.data,r)),a(e,r)})}function o(n,i){var o=t.require("Url").get(n),s=new XMLHttpRequest;s.open("get",o,!0),s.onreadystatechange=function(){4==s.readyState&&(200==s.status?a(e("JSON").parse(s.responseText),i):r(i.error))},s.send(null)}function a(e,t){if(e){var n=t.successCode,i=t.field,o=e[i.code];if(o==n){var a=e[i.data]||{};r(t.success,a,e)}else{var s=e[i.msg]||"";r(t.fail,o,s,e)}}else r(t.error)}var s=e("Defaults"),l=e("Fn"),u=null;t.exports={request:function(t,n){var r=e("Url");if(r.isExt(t,".js"))i(t,n);else{if(!r.isExt(t,".json"))throw new g("不支持参数 file 的文件类型: "+t);o(t,n)}},response:function(e){u=e}}}),A("Proxy.defaults",{base:"",delay:{min:500,max:3e3}}),A("Fn",function(e,t,n){t.exports={delay:function(t,n,r){if(n){if(!1!==t&&null!=t){var i=e("Math"),o="number"==typeof t?t:i.randomInt(t.min,t.max);return f(function(){n.apply(null,r)},o)}n.apply(null,r)}}}}),A("Math",function(e,t,n){t.exports=n={randomInt:function(e,t){var n=arguments.length;if(0==n)return x(I(b.random()).replace(".","").replace(/^0*/g,""));1==n&&(t=e,e=0);var r=t-e+1;return b.floor(b.random()*r+e)},slide:function(e,t,n){return n=n||1,(e+=n)>=0?e%t:(t-b.abs(e)%t)%t},next:function(e,t){return n.slide(e,t,1)},previous:function(e,t,r){return n.slide(e,t,-1)},parsePercent:function(e){if("string"!=typeof e)return e;var t=e.trim();return"%"!=t.slide(-1)?e:parseFloat(t)/100}}}),A("Script",function(e,t,n){function i(e,t,n,r){var i;if("object"==typeof e){var o=e;i=o.id,e=o.url,t=o.charset,n=o.document,r=o.onload}var a=n.createElement("script");r&&(a.readyState?a.onreadystatechange=function(){var e=a.readyState;"loaded"!=e&&"complete"!=e||(a.onreadystatechange=null,r())}:a.onload=r),a.src=e,t&&(a.charset=t),i&&(a.id=i),n.head.appendChild(a)}function o(e,t,n,r){if(0!=e.length){var o=0;!function(){var a=arguments.callee;i(e[o],t,n,function(){++o<e.length?a():r&&r()})}()}else r&&r()}e("String");var a=e("Object"),s={url:"",id:"",charset:"utf-8",document:r.document,onload:null};t.exports={load:function(e){var t=S.assign({},s);if(a.isPlain(e))S.assign(t,e);else{switch(t.url=e,typeof arguments[1]){case"string":t.charset=arguments[1];break;case"object":t.document=arguments[1];break;case"function":t.onload=arguments[1]}switch(typeof arguments[2]){case"object":t.document=arguments[2];break;case"function":t.onload=arguments[2]}arguments[3]&&(t.onload=arguments[3])}var n=t.url;if("string"==typeof n)i(t);else{if(!(n instanceof p))throw new g("参数 params.url 必须为 string 或 string 的数组");o(n,t.charset,t.document,t.onload)}}}}),A("String",function(e,t,n){t.exports=n={format:function(e,t){var r=e,i=n.replaceAll;if("object"==typeof t)for(var o in t){u=t[o];p.isArray(u)&&(u=u.join("")),r=i(r,"{"+o+"}",u)}else for(var a=[].slice.call(arguments,1),s=0,l=a.length;s<l;s++){var u=a[s];p.isArray(u)&&(u=u.join("")),r=i(r,"{"+s+"}",u)}return r},replaceAll:function(e,t,n){return e.split(t).join(n)},replaceBetween:function(e,t,n,r){var i=e.indexOf(t);if(i<0)return e;var o=e.indexOf(n,i+t.length);return o<0?e:e.slice(0,i)+r+e.slice(o+n.length)},padLeft:function(e,t,n){var r=(e=I(e)).length;if(t<=r)return e.substr(-t);n=n||" ";var i=[];return i.length=t-r+1,i.join(n)+e},padRight:function(e,t,n){var r=(e=I(e)).length;if(r>=t)return e.substring(0,t);n=n||" ";var i=[];return i.length=t-r+1,e+i.join(n)},between:function(e,t,n){var r=e.indexOf(t);if(r<0)return"";r+=t.length;var i=e.indexOf(n,r);return i<0?"":e.substr(r,i-r)},random:function(e){if(e===j&&(e=12),"number"==typeof e){var t=e+1;t<0&&(t=0),(e=[]).length=t,e=e.join("x")}return e.replace(/x/g,function(e){return(16*b.random()|0).toString(16)}).toUpperCase()},toCamelCase:function(e){var t=/^-ms-/,n=/-([a-z]|[0-9])/gi;return e.replace(t,"ms-").replace(n,function(e,t){return t.toString().toUpperCase()})},toHyphenate:function(e){return e.replace(/[A-Z]/g,function(e){return"-"+e.charAt(0).toLowerCase()})},toUtf8:function(t){var n=e("Array"),r=[];return n.each(t.split(""),function(e,t){var n=e.charCodeAt(0);n<128?r.push(n):n<2048?(r.push((1984&n)>>6|192),r.push(63&n|128)):(r.push((61440&n)>>12|224),r.push((4032&n)>>6|128),r.push(63&n|128))}),"%"+n.keep(r,function(e,t){return e.toString(16)}).join("%")},toValue:function(e){if("string"!=typeof e)return e;var t={true:!0,false:!1,null:null,undefined:j,NaN:NaN};return e in t?t[e]:e},split:function(t,n){function r(e,t,n){return n--,i.map(e,function(e,i){return 0==n?I(e).split(t):r(e,t,n)})}for(var i=e("Array"),o=I(t).split(n[0]),a=1,s=n.length;a<s;a++)o=r(o,n[a],a);return o},getTemplates:function(e,t){var r=t[0],i=n.between,o=n.replaceBetween,a={},s=i(e,r.begin,r.end);(t=t.slice(1).reverse()).forEach(function(e,t){var n=e.name||t,r=e.begin,l=e.end,u=e.fn,c=i(s,r,l);"outer"in e&&(s=o(s,r,l,e.outer)),u&&(c=u(c,e)),a[n]=c});var l=r.fn;return l&&(s=l(s,r)),a[r.name]=s,a},getByteLength:function(e){return e?e.toString().replace(/[\u0100-\uffff]/g,"  ").length:0}}}),A("JSON",function(e,t,n){var i=r.JSON;t.exports={parse:function(e){try{return n=i.parse(e)}catch(t){u.warn("使用原生的 JSON.parse() 方法无法解析:",e)}try{var t=["return (function () { ","   var obj = "+e+";","   return obj;","})();"].join("\r\n"),n=new m(t)();return n}catch(t){u.warn("使用 new Function() 方法无法解析:",e)}return null},stringify:function(){return i.stringify(...arguments)}}}),A("Url",function(e,t,n){e("String");var r="",o="",a="";t.exports=n={root:function(){if(r)return r;var n=e("Defaults").get(t.id);return"function"==typeof(r=n.root)&&(r=r()),"/"!=r.slice(-1)&&(r+="/"),r},dir:function(){if(a)return a;var e=n.get();return a=e.split("/").slice(0,-1).join("/")+"/"},get:function(){if(o)return o;var n=e("KISP"),r=e("Defaults").get(t.id).id,a=null;if(r&&(a=i.getElementById(r)),!a){var s="kisp."+n.edition+".js",l=i.querySelectorAll("script");a=p.from(l).find(function(e){return e.src.split("?")[0].endsWith(s)})}return o=a.src.split("?")[0]},main:function(e){return e=e.split("#")[0],e=e.split("?")[0]},isFull:function(e){return"string"==typeof e&&(e.startsWith("http://")||e.startsWith("https://"))},isExt:function(e,t){return"string"==typeof e&&"string"==typeof t&&(e=n.main(e)).slice(0-t.length).toLowerCase()==t.toLowerCase()},resolve:function(e){var t=arguments.length;if(0==t)throw new g("resolveUrl requires at least one argument; got none.");var n=i.createElement("base");if(n.href=e,1==t)return n.href;var r=i.head;r.insertBefore(n,r.firstChild);for(var o="",a=i.createElement("a"),s=1;s<t;s++)a.href=arguments[s],o=a.href,n.href=o;return r.removeChild(n),o}}}),A("Url.defaults",{root:o.protocol+"//"+o.host+o.pathname.split("/").slice(0,-1).join("/")+"/",id:"script-KISP"}),A("Proxy/Url",function(e,t,n){function r(e){if(a.isFull(e))return e;var n=i.get(t.parent.id).base;if(a.isFull(n))return n+e;var r=a.root();return"/"!=e.slice(0,1)&&(r+=n),r+e}var i=e("Defaults"),o=e("Query"),a=e("Url");return{get:function(e){return e=r(e),o.random(e)}}}),A("Query",function(e,t,n){var r=e("Object");t.exports=n={parse:function(t,r,i){if(!t||"string"!=typeof t)return{};var o=e("String"),a=i?unescape:decodeURIComponent,s=!r,l=o.toValue,u={};return t.split("&").map(function(e){var t=e.split("="),r=a(t[0]),i=t[1];if(t.length>1&&(i=a(i),i=s&&i.indexOf("=")>0?n.parse(i):l(i)),r in u){var o=u[r];o instanceof p?o.push(i):u[r]=[o,i]}else u[r]=i}),u},stringify:function(e,t){if(null==e)return I(e);switch(typeof e){case"string":case"number":case"boolean":return e}if(e instanceof I||e instanceof x||e instanceof v||e instanceof h)return e.valueOf();if(p.isArray(e))return"["+e.join(", ")+"]";var i=t?escape:encodeURIComponent,o=[];return r.each(e,function(e,t){e=i(e),t!==j?(t=n.stringify(t),t=i(t),o.push(e+"="+t)):o.push(e)}),o.join("&")},get:function(e,t,r){"object"==typeof e&&(e="href"in e?e.href:e.location.href);var i=e.indexOf("?");if(!(i<0)){var o=e.indexOf("#");o<0&&(o=e.length);var a=e.slice(i+1,o);if(""===t)return decodeURIComponent(a);var s=n.parse(a);if(t===j)return s;if(!r||t in s)return s[t];t=t.toString().toLowerCase();for(var l in s)if(l.toLowerCase()==t)return s[l]}},add:function(e,t,r){var i=n.get(e)||{};"object"==typeof t?S.assign(i,t):i[t]=r;var o={};for(var t in i)null!==(r=i[t])&&(o[t]=r);return n.set(e,o)},random:function(t,r){var i=e("String").random(r);return n.add(t,i,j)},set:function(e,t,i){var o=null;"object"==typeof e&&(e=(o="href"in e?e:e.location).href);var a=typeof t,s=/^(string|number|boolean)$/.test(a),l="";if(2==arguments.length&&s)l=encodeURIComponent(t);else{var u="object"==a?t:r.make(t,i);l=n.stringify(u)}var c,f=e.indexOf("?")>-1,d=e.indexOf("#")>-1;return f&&d?(c=e.split(/\?|#/g))[0]+"?"+l+"#"+c[2]:f?(c=e.split("?"))[0]+"?"+l:d?(c=e.split("#"))[0]+"?"+l+"#"+c[1]:(e=e+"?"+l,o&&(o.href=e),e)},has:function(e,t,i){"object"==typeof e&&(e="href"in e?e.href:e.location.href);var o=n.get(e);if(!o)return!1;if(!t)return!r.isEmpty(o);if(t in o)return!0;if(i){t=t.toString().toLowerCase();for(var a in o)if(a.toLowerCase()==t)return!0}return!1},escape:function(e){var t=I(e);return escape(t).replace(/\+/g,"%2B")}}}),A("App",function(e,t,n){function o(t){var n=e("Loader"),i=e("Module").define;n.preload(function(e){C=r.jQuery,e.forEach(function(e){l[e]||(i(e,function(){return r[e]}),l[e]=!0)}),l.$||(i("$",function(){return C}),l.$=!0),t&&t()})}function a(e,t,n){n.on("back",function(e,n){i.activeElement.blur(),e=t.require(e),n=t.require(n),e.hide(),n.show()}),n.on("before-to",function(e,n){(e=t.require(e)).hide()}),n.on("to",function(e,n,r,i){var o=[].slice.call(arguments,1),a=t.require(e);a.render.apply(a,o)})}e("String");var s=e("Defaults").get(t.id),l={};t.exports={launch:function(n){o(function(){var r=e("Module"),i=r.define,o=s.name;i(o,function(r,i){var o=t.require("Nav").create(i);a(0,i,o);var s=e("Router").get(r,i,o);i.bind(s),n&&n(r,i,o)}),r.require(o)})}}}),A("App.defaults",{name:"",animated:!0}),A("Loader",function(e,t,n){var i=e("Script"),o=e("StyleSheet"),a=e("Defaults"),s=t.require("Url"),l=a.get(t.id);return{preload:function(e){var t=l.preload,n=s.group(t,l.vars);o.load(n.css,function(){i.load(n.js,function(){var n=S.keys(t);e&&e(n)})})},lazyload:function(e,t){var n=l.lazyload,a=l.vars;p.isArray(e)||(e=[e]);var u=[];e.forEach(function(e){var t=n[e];if(!t)throw new g("不存在名为 "+e+" 的 lazyload 配置。");u=u.concat(t)}),u=s.group(u,a),o.load(u.css,function(){i.load(u.js,function(){var n=e.map(function(e){return r[e]});t&&t.apply(null,n)})})},load:function(e,t){e=s.group(e,l.vars),o.load(e.css,function(){i.load(e.js,function(){t&&t()})})}}}),A("Loader.defaults",function(e,t,n){var r=e("KISP"),i=e("Url");return{vars:{version:r.version,edition:r.edition,dir:i.dir(),root:i.root()},preload:{KISP:["{dir}kisp.{edition}.css"],jQuery:["{dir}jquery/jquery-2.1.1.{edition}.js"]},lazyload:{}}}),A("StyleSheet",function(e,t,n){function i(e,t,n,r){var i;if("object"==typeof e){var o=e;i=o.id,e=o.url,t=o.charset,n=o.document,r=o.onload}var a=n.createElement("link");r&&(a.readyState?a.onreadystatechange=function(){var e=a.readyState;"loaded"!=e&&"complete"!=e||(a.onreadystatechange=null,r())}:a.onload=r),a.href=e,a.rel="stylesheet",t&&(a.charset=t),i&&(a.id=i),n.head.appendChild(a)}function o(e,t,n,r){if(0!=e.length){var o=0;!function(){var a=arguments.callee;i(e[o],t,n,function(){++o<e.length?a():r&&r()})}()}else r&&r()}var a={url:"",id:"",charset:"utf-8",document:r.document,onload:null};t.exports={load:function(t){var n=e("Object"),r=S.assign({},a);if(n.isPlain(t))S.assign(r,t);else{switch(r.url=t,typeof arguments[1]){case"string":r.charset=arguments[1];break;case"object":r.document=arguments[1];break;case"function":r.onload=arguments[1]}switch(typeof arguments[2]){case"object":r.document=arguments[2];break;case"function":r.onload=arguments[2]}arguments[3]&&(r.onload=arguments[3])}var s=r.url;if("string"==typeof s)i(r);else{if(!(s instanceof p))throw new g("参数 params.url 必须为 string 或 string 的数组");o(s,r.charset,r.document,r.onload)}}}}),A("Loader/Url",function(e,t,n){function r(e){if(e=s.resolve(e),e=s.main(e),l[e])return!0;var t="",n="";if(s.isExt(e,".js"))t="script",n="src";else{if(!s.isExt(e,".css"))throw new g("无法识别的 url 类型: "+e);t="link",n="href"}var r=i.querySelectorAll(t);return!!p.from(r).find(function(t){var r=t[n];return s.main(r)==e})&&(l[e]=!0,!0)}var o=e("Object"),a=e("String"),s=e("Url"),l={};return{group:function(e,t){"string"==typeof e&&(e=[e]),p.isArray(e)&&(e=o.make("",e));var n=[],i=[];return o.each(e,function(e,o){p.isArray(o)||(o=[o]),o.forEach(function(e){if(e=a.format(e,t),!r(e))if(s.isExt(e,".js"))i.push(e);else{if(!s.isExt(e,".css"))throw new g("不支持该类型的 url 预加载: "+e);n.push(e)}})}),{css:n,js:i}}}}),A("Module",function(e,t,n){var r=e("Defaults"),i=e("Emitter"),o=r.clone(t.id,{Emitter:i,require:function(t,n){if("string"!=typeof t)throw new g("参数 id 的类型必须为 string。");var r=arguments.length;if(1==r)return a.require(t,!o.cross);var i=p.from(arguments),s=i.slice(0,-1);n=i[r-1];var l=e("Package"),u=e.new("Tasks",s);u.on({each:function(e,t,n){l.load(e,function(){var t=a.require(e,o.cross);n(t)})},all:function(e){n&&n.apply(null,e)}}),u.parallel()}}),a=new q(o);return{define:a.define.bind(a),require:a.require.bind(a)}}),A("Module.defaults",{seperator:"/",cross:!1,repeated:!1}),A("Tasks",function(e,t,n){function r(e){var t={emitter:new i(this),list:e};o.set(this,t)}var i=e("Emitter"),o=new w;return r.prototype={constructor:r,parallel:function(){var e=o.get(this),t=e.list,n=e.emitter,r=t.length;if(0!=r){var i=new p(r),a=new p(r),s=r;t.forEach(function(e,t){!function(t){n.fire("each",[e,t,function(e){if(i[t]=e,a[t]=!0,!(--s>0)){for(var o=0;o<r;o++)if(!a[o])return;n.fire("all",[i])}}])}(t)})}else n.fire("all",[])},serial:function(){function e(t){var o=n[t];r.fire("each",[o,t,function(n){a[t]=n,++t<i?e(t):r.fire("all",[a])}])}var t=o.get(this),n=t.list,r=t.emitter,i=n.length;if(0!=i){var a=new p(i);e(0)}else r.fire("all",[])},on:function(){var e=o.get(this).emitter,t=p.from(arguments);e.on(t)}},S.assign(r,{}),r}),A("Emitter",function(e,t,n){function r(e){var t={context:e,tree:new o};a.set(this,t)}var i=e("Object"),o=e("Tree"),a=new w;return r.prototype={constructor:r,on:function(e,t){if(p.isArray(e))t?e.map(function(e){this.on(e,t)},this):this.on(...e);else{var n=a.get(this).tree,r=p.from(arguments),o=r.findIndex(function(e,t){return"object"==typeof e});if(o>=0){var s=r[o],l=r.slice(0,o);i.flat(s).forEach(function(e,t){var r=l.concat(e.keys),i=n.get(r)||{list:[],count:0};i.list.push(e.value),n.set(r,i)})}else{if((o=r.findIndex(function(e,t){return"function"==typeof e}))<0)throw new g("参数中必须指定一个回调函数");t=r[o];l=r.slice(0,o);l=l.filter(function(e){return!!e});var u=n.get(l)||{list:[],count:0,enabled:!0,spreaded:!0};u.list.push(t),n.set(l,u)}}},off:function(e,t){var n=a.get(this).tree,r=p.from(arguments);if(0!=r.length){var o=r.findIndex(function(e,t){return"object"==typeof e});if(o>=0){var s=r[o],l=r.slice(0,o);(c=i.flat(s)).forEach(function(e,t){var r=l.concat(e.keys),i=n.get(r);if(i){var o=i.list;if(o&&o.length){var a=e.value;i.list=o.filter(function(e){return e!==a})}}})}else{(o=r.findIndex(function(e,t){return"function"==typeof e}))<0&&(o=r.length),t=r[o];var l=r.slice(0,o),u=n.get(l);if(u){var c=u.list;c&&c.length&&(t?u.list=c.filter(function(e,n){return e!==t}):c.length=0)}}}else n.clear()},fire:function(e,t){var n=a.get(this),r=n.tree,i=n.context,o=p.from(arguments),s=o.findIndex(function(e,t){return p.isArray(e)});s<0&&(s=o.length);var l=o.slice(0,s),u=r.get(l),c=[];return u?(t=o[s]||[],u.count++,u.list.forEach(function(e,n){var r=e.apply(i,t);c.push(r)}),c):c},set:function(e,t){var n=a.get(this);switch(e){case"context":n[e]=t;break;default:throw new g("不支持设置属性: "+e)}},destroy:function(){a.get(this).tree.destroy(),a.delete(this)}},r}),A("Tree",function(e,t,n){function r(){var e={key$node:{},count:0};o.set(this,e)}function i(e,t){for(var n=t.length-1,r=0;r<=n;r++){var i=e[t[r]];if(!i||r==n)return i||null;e=i.key$node}}var o=new w;return r.prototype={constructor:r,set:function(e,t){if(!p.isArray(e)){var n=p.from(arguments);e=n.slice(0,-1),t=n.slice(-1)[0]}if(!(e=e.filter(function(e){return!!I(e)})).length)throw new g("过滤后的节点 key 为空数组。");var r=o.get(this),i=r.key$node,a=e.length-1,s=null;e.forEach(function(e,n){(s=i[e])||(r.count++,s=i[e]={key$node:{},parent:i,key:e}),n<a?i=s.key$node:s.value=t})},get:function(e){if(p.isArray(e)||(e=p.from(arguments)),!(e=e.filter(function(e){return!!I(e)})).length)throw new g("过滤后的节点 key 为空数组。");var t=i(o.get(this).key$node,e);return t?t.value:j},clear:function(){var e=o.get(this);e.key$node={},e.count=0},remove:function(t){if(p.isArray(t)||(t=[...arguments]),!(t=t.filter(function(e){return!!I(e)})).length)throw new g("过滤后的节点 key 为空数组。");var n=o.get(this),r=i(n.key$node,t);if(r){var a=e("Object"),s=r.key$node;!s||a.isEmpty(s)?(n.count--,delete r.parent[r.key]):delete r.value}},destroy:function(){o.delete(this)}},r}),A("Package",function(e,t,n){function r(t,n){if(s)n&&n(s[t]);else if(!1!==s){var r=e("Query"),i=e("Url").root()+a.url,o=a.query;"string"==typeof o&&(o=r.parse(o)),o&&(i=r.add(i,o)),a.random&&(i=r.random(i,4)),C.ajax({type:"get",dataType:"json",url:i,error:function(){s=!1,n&&n()},success:function(e){s=e,n&&n(e[t])}})}else n&&n()}var i=e("Defaults"),o=t.require("Loader"),a=i.clone(t.id),s=null,l=null,u={};return{load:function(t,n){var i=u[t];if(i||null===i)n&&n(i);else{var s=a.load||{},c=s.begin,f=s.end;c&&(l=c(e,l)),r(t,function(r){if(!r)return u[t]=null,f&&f(e,l),void(n&&n());o.load(r,function(r){u[t]=r,f&&f(e,l),n&&n(r)})})}}}}),A("Package.defaults",{url:"packages/all.json",random:!0,query:null,load:{begin:function(e,t){return t||(t=new(e("Loading"))),t.show(),t},end:function(e,t){t.hide()}}}),A("Loading",function(e,t,n){function r(t){var n=y.get(this),r=n.id,o=n.sample,s=e("Style"),l=a.format(o,{id:r,"text-id":n.textId,text:n.text,style:s.stringify(t),cssClass:n.cssClass}),u=n.container;n.append?C(u).append(l):C(u).prepend(l);var c=i.getElementById(r);return n.div=c,c}function o(e){var n=e?m[e.presetting]:null;e=l.clone(t.id,n,e);var r=new s(this),i=e.cssClass;i instanceof p&&(i=i.join(" "));var o=e.text;o||0===o||(i+=" NoText"),i=i.split(" ").map(function(e,t){return"same-line"==e?(u.warn('类名 "same-line" 已过时，请使用 "SameLine"'),"SameLine"):e}).join(" ");var a=e.prefix,f=e.suffix,h={id:c.get(a,f),textId:c.get(a,"text-",f),container:e.container,prepend:e.prepend,div:null,sample:d.get(e.sample),text:o,emitter:r,mask:e.mask,masker:null,style:v.get(e),showTime:0,cssClass:i,append:e.append};y.set(this,h)}var a=e("String"),s=e("Emitter"),l=e("Defaults"),c=e("RandomId"),d=t.require("Sample"),v=t.require("Style"),m=t.require("Presettings"),y=new w;return o.prototype={constructor:o,render:function(){},show:function(t,n){"object"==typeof t&&(t=(n=t).text),n=n||{};var o=y.get(this),a=o.div,s=v.get(o.style,n);a||(a=r.call(this,s)),C(a).css(s);var l=e("Mask"),u=l.filter(o.mask,n.mask),c=o.masker;u?(c||(c=o.masker=new l({container:o.container})),c.show(u)):c&&c.hide(),t!==j&&t!=o.text&&(i.getElementById(o.textId).innerHTML=t,o.text=t),o.showTime=h.now(),C(a).show(),o.emitter.fire("show");var d=n.duration;if(d){var p=this;f(function(){p.hide()},d)}},hide:function(e){function t(){var e=n.masker;e&&e.hide(),n.showTime=0,C(r).hide(),n.emitter.fire("hide")}var n=y.get(this),r=n.div;if(r)if(e){var i=e-(h.now()-n.showTime);i>0?f(t,i):t()}else t()},remove:function(){var e=y.get(this),t=e.div;if(t){var n=e.masker;n&&n.remove(),e.div=null,e.masker=null,e.hasBind=!1,C(t).off(),i.body.removeChild(t),e.emitter.fire("remove")}},set:function(e,t){var n=y.get(this);switch(e){case"text":n.text=t,C("#"+n.textId).html(t);break;default:throw new g("暂不支持设置名为` "+e+"` 的属性。")}},on:function(e,t){var n=y.get(this).emitter,r=[].slice.call(arguments,0);n.on.apply(n,r)},destroy:function(){var e=y.get(this).emitter;this.remove(),e.destroy(),y.remove(this)}},o}),A("Loading.defaults",{prefix:"KISP-Loading-",suffix:4,text:"处理中...",mask:!1,sample:"iOS",cssClass:"",container:i.body,append:!1,background:"rgba(0, 0, 0, 0.7)","border-radius":10,bottom:"initial",color:"#fff","font-size":"15px",height:102,left:"50%",right:"initial",top:"50%",width:120,"z-index":1024}),A("Loading.config",{position:"fixed"}),A("RandomId",function(e,t,n){var r=e("String");t.exports={get:function(e,t,n,i){var o=p.from(arguments);return(o=o.map(function(e,t){return"number"==typeof e?r.random(e).toLowerCase():e})).join("")}}}),A("Style",function(e,t,n){function r(e){return"number"==typeof e||/^\d+$/g.test(e)?e+"px":e}var i=e("Object"),o=["border","border-radius","border-bottom-width","border-left-width","border-right-width","border-top-width","border-width","bottom","font-size","height","left","letter-spacing","line-height","margin","margin-bottom","margin-left","margin-right","margin-top","padding","padding-bottom","padding-left","padding-right","padding-top","right","top","width"];t.exports=n={pixelize:function(e,t){if("object"!=typeof e)return r(e);if(t instanceof p)t.forEach(function(t,n){var i=e[t];null!=i&&(e[t]=r(i))});else{var n=e[t];null!=n&&(e[t]=r(n))}return e},checkUnit:function(e,t){return"string"==typeof e&&e.slice(0-t.length)==t},filter:function(e,t){p.isArray(e)||(e=[e]);var r=e.map(function(e,n){return e&&"object"==typeof e?e=i.filter(e,t):null});r=[{}].concat(r);var a=S.assign.apply(null,r);return a=n.pixelize(a,o)},parse:function(e){},stringify:function(e,t,n){if(!e)return"";"number"==typeof t&&(n=t,t=null);var r=[];return i.each(e,function(e,i){if((i=t?t(e,i):i)!==j){var o=e+": "+i;n&&(o=new p(n+1).join(" ")+o),r.push(o)}}),0==r.length?"":n?r.join(";\n")+";\n":r.join(";")+";"},parsePercent:function(e,t){return(e=parseInt(e)/100)*t+"px"}}}),A("Mask",function(e,t,n){function r(e){var n=(e=a.clone(t.id,e)).prefix,r=e.suffix,o=new i(this),f={id:s.get(n,r),div:null,sample:l,volatile:e.volatile,emitter:o,style:u.get(e),showTime:0,container:e.container,duration:e.duration,append:e.append,eventName:e.eventName};c.set(this,f)}var i=e("Emitter"),o=e("String"),a=e("Defaults"),s=e("RandomId"),l=t.require("Sample"),u=t.require("Style"),c=new w;return r.prototype={constructor:r,$:null,render:function(){var e=c.get(this);if(!e.div){var t=e.id,n=e.sample,r=e.eventName,i=o.format(n,{id:t}),a=C(e.container);e.append?a.append(i):a.prepend(i);var s=e.div=C("#"+t);this.$=s;var l=u.get(e.style);if(s.css(l),e.volatile){var d=this,p=function(){if(!1!==d.hide()){var e=s.css("opacity");d.show({opacity:0,quiet:!0}),f(function(){s.css("opacity",e).hide()},200)}};"touch"==r?s.touch(p):s.on(r,p)}}},show:function(e){"number"==typeof e&&(e={duration:e});var t=c.get(this),n=t.emitter;this.render();var r=t.div,i=!1;if(e){var o=u.get(t.style,e);r.css(o),i=e.quiet}t.showTime=new h,r.show(),i||n.fire("show");var a=e&&"duration"in e?e.duration:t.duration;if(a){var s=this;f(function(){s.hide()},a)}},hide:function(e){function t(){if(!1===n.emitter.fire("hide").slice(-1)[0])return!1;n.showTime=0,r.hide()}var n=c.get(this),r=n.div;if(r){if(!e)return t();var i=e-(new h-n.showTime);i>0&&f(t,i)}},remove:function(){var e=c.get(this),t=e.div;t&&(e.div=null,t.off(),(t=t.get(0)).parentNode.removeChild(t),e.emitter.fire("remove"))},on:function(e,t){var n=c.get(this).emitter,r=[].slice.call(arguments,0);n.on.apply(n,r)},destroy:function(){var e=c.get(this);this.remove(),e.emitter.destroy(),c.delete(this)}},S.assign(r,{filter:function(e,t){"number"==typeof e&&(e={opacity:e}),"number"==typeof t&&(t={opacity:t});var n=typeof e;return"object"==n&&"object"==typeof t?S.assign({},e,t):!1===t?null:!0===t?e&&"object"==n?e:{}:t===j?"object"==n?e:e?{}:null:"object"==typeof t?t:t?{}:null}}),r}),A("Mask.defaults",{prefix:"KISP-Mask-",suffix:4,volatile:!1,container:i.body,append:!1,eventName:"",duration:0,top:0,bottom:0,opacity:.5,background:"#000","z-index":1024}),A("Mask.config",{position:"fixed",eventName:"click"}),A("Mask/Sample",['<div id="{id}" class="KISP Mask" style="display: none;"></div>'].join("\n")),A("Mask/Style",function(e,t,n){var r=e("Style");return{get:function(e,t,n){var i=[].slice.call(arguments);return r.filter(i,["opacity","top","bottom","background","z-index","position"])}}}),A("Loading/Sample",function(e,t,n){var r={};return{get:function(e){var n=r[e];return n||(n=t.require(e),r[e]=n,n)}}}),A("Loading/Style",function(e,t,n){function r(e){var t=typeof e;return"number"==t?0-e/2+"px":"string"==t&&"px"==e.slice(-2)?0-(e=parseInt(e))/2+"px":"0px"}var i=e("Style");return{get:function(e,t,n){var o=[].slice.call(arguments),a=i.filter(o,["background","border-radius","bottom","color","font-size","height","left","margin-top","right","top","width","z-index","position"]);return a["margin-left"]=r(a.width),a["margin-top"]===j&&(a["margin-top"]=r(a.height)),a}}}),A("Loading/Presettings",{fullscreen:{width:"100%",height:"100%",top:0,left:0,bottom:0,right:0,"font-size":15,"margin-top":0,"margin-left":0,"margin-right":0,"margin-bottom":0,"border-radius":0},"scroller.pulldown":{sample:"iOS",cssClass:"SameLine",text:"加载中...",background:"none",color:"#000",height:26,width:"100%",left:0,top:0,bottom:"initial",right:"initial","font-size":15,"margin-top":0,"border-radius":0},"scroller.pullup":{sample:"iOS",cssClass:"SameLine",text:"加载中...",background:"none",color:"#000",height:26,width:"100%",top:"initial",right:"initial",left:0,bottom:0,"font-size":15,"margin-top":0,"border-radius":0}}),A("Package/Loader",function(e,t,n){function r(e,t){for(var n in e)if(!e[n].ready)return;t&&t(e)}var o=e("Object"),a={css:function(e,t){var n=i.createElement("link");n.rel="stylesheet",n.onload=function(){t&&t()},n.onerror=function(){throw new g("css 文件加载失败: "+e)},n.href=e,i.head.appendChild(n)},html:function(e,t){C.ajax({type:"get",url:e,dataType:"html",cache:!0,error:function(e,t,n){throw n},success:function(e,n,r){t&&t(e)}})},js:function(e,t){C.ajax({type:"get",url:e,dataType:"script",cache:!0,error:function(e,t,n){throw n},success:function(e,n,r){t&&t(e)}})}};return{load:function(t,n){var i={},s=e("Url").root();o.each(a,function(e,n){var r=t[e];r&&(r=s+r,i[e]={url:r,ready:!1,content:""})}),o.each(i,function(e,t){var o=t.url;(0,a[e])(o,function(e){t.ready=!0,t.content=e||"",r(i,n)})})}}}),A("App/Nav",function(e,t,n){var r=e("Navigator"),i=(e("String"),e("Defaults")),o=e("Emitter");return{create:function(n){var a=i.clone(t.id),s=new r({hash:a.hash}),l=new o(s),u=s.to,c=s.on;return s.to=function(t,r,i){var o=p.from(arguments);n.require(t)?u.apply(s,o):e("Package").load(t,function(e){if(!e)throw l.fire("404",o),new g("不存在名为 "+t+" 的分包配置数据。");var r=e.html;if(r&&C(a.container).append(r.content),!n.require(t))throw l.fire("404",o),new g("不存在名为 "+t+" 的视图");u.apply(s,o)})},s.on=function(e,t){if("404"!=e){var n=p.from(arguments);c.apply(s,n)}else l.on(e,t)},s}}}),A("App/Nav.defaults",function(e,t,n){var r=e("String");return{container:"body",hash:function(e){return e+"-"+r.random(4)}}}),A("Navigator",function(e,t,n){function i(e){var t=new o(this),n=this,i=e.hash,l={emitter:t,statcks:[],quiet:!1,hash:i};s.set(this,l),i&&a.onchange(r,function(e,t){l.quiet?l.quiet=!1:n.back()})}e("String");var o=e("Emitter"),a=e("Hash"),s=new w;return i.prototype={constructor:i,on:function(e,t){var n=s.get(this).emitter,r=p.from(arguments);n.on.apply(n,r)},to:function(e,t){var n=s.get(this),i=n.emitter,o=n.statcks,l=p.from(arguments),u=o.slice(-1)[0];u&&i.fire("before-to",[u,e]),o.push(e),i.fire("to",l),n.quiet=!0;var c=n.hash;"function"==typeof c&&(c=c.call(this,e)),c&&a.set(r,c)},back:function(e){var t=!0;if(!1===e&&(t=!1),(e=e||1)<0)throw new g("要后退的步数必须大于 0");var n=s.get(this),r=n.statcks,i=r.length-1,o=i-e;if(!(o<0)){var a=r[i],l=r[o];return r.splice(o+1),t&&n.emitter.fire("back",[a,l]),l}},get:function(e){var t=s.get(this).statcks,n=t.length;return e<0&&(e+=n),t[e]}},i}),A("Hash",function(e,t,n){var r=e("Object"),i=null,o=null;t.exports=n={get:function(t,n,r){"object"==typeof t&&(t="href"in t?t.href:t.location.href);var i=t.indexOf("#");if(!(i<0)){var o=t.length,a=t.slice(i+1,o);if(a=unescape(a),""===n)return a;var s=e("Query").parse(a);if(n===j)return s;if(!r||n in s)return s[n];n=n.toString().toLowerCase();for(var l in s)if(l.toLowerCase()==n)return s[l]}},set:function(t,n,i){var o=null;"object"==typeof t&&(t=(o="href"in t?t:t.location).href);var a=typeof n,s=/^(string|number|boolean)$/.test(a),l="";if(2==arguments.length&&s)l=I(n);else{var u=e("Query"),c="object"==a?n:r.make(n,i);l=u.stringify(c)}l=escape(l);var f=t.lastIndexOf("#");return f>-1&&(t=t.slice(0,f)),t=t+"#"+l,o&&(o.hash=l),t},has:function(e,t,i){"object"==typeof e&&(e="href"in e?e.href:e.location.href);var o=n.get(e);if(!o)return!1;if(!t)return!r.isEmpty(o);if(t in o)return!0;if(i){t=t.toString().toLowerCase();for(var a in o)if(a.toLowerCase()==t)return!0}return!1},onchange:function(t,r,a){if(!i){var s=e("Emitter");i=new s}i.on("change",r);t.location;var l=n.get(t,"");l&&a&&r.call(t,l,null),o||(o=new w),o.get(t)||(t.onhashchange=function(){var e=l;l=n.get(t,""),i.fire("change",[l,e])},o.set(t,!0))}}}),A("Alert",function(e,t,n){var r=e("String"),i=t.require("Dialog");return{show:function(e,n,o,a){if("object"==typeof e){var s=t.require("Sample");e=y.stringify(e,null,4),e=r.format(s,{text:e})}var l=[].slice.call(arguments,1),u=l.findIndex(function(e,t){return"function"==typeof e});u>=0?(a=l[u],l=l.slice(0,u)):a=null,l=[e].concat(l),e=r.format.apply(null,l),i.add(e,a)}}}),A("Alert.defaults",{button:"确定",volatile:!1,mask:!0,autoClosed:!0,width:"80%","z-index":99999}),A("Alert.config",{width:450}),A("Alert/Dialog",function(e,t,n){function r(){var t=c.clone("Alert"),n=new(e("Dialog"))({cssClass:"Alert",volatile:t.volatile,mask:t.mask,autoClosed:t.autoClosed,width:t.width,"z-index":t["z-index"],buttons:[{name:"ok",text:t.button}]});return n.on("button","ok",function(){var e=n.data("fn");e&&e()}),n.on({show:function(){d=!0,h=13==h?"enter":"",(v=i.activeElement).blur()},hide:function(){d=!1;var e=p.shift();e&&l(e.text,e.fn),v=null,h=""}}),C(i).on({keydown:function(e){h=e.keyCode},keyup:function(e){if(!(13!=e.keyCode||!d||"enter"==h)){n.hide();var t=n.data("fn");t&&t()}}}),n}function o(e){e=I(e);var t=u.getByteLength(e),n=b.max(t,125);return n>=.8*i.documentElement.clientHeight&&(n="80%"),n}function a(e){var t=25*(e=I(e)).split("\n").length+60;return t>=.8*i.documentElement.clientHeight&&(t="80%"),t}function s(e){var t=o(e),n=a(e);return b.max(t,n)}function l(e,t){var n=s(e);(f=f||r()).data("fn",t),f.set("text",e),f.set("height",n),f.show()}var u=e("String"),c=e("Defaults"),f=null,d=!1,p=[],v=null,h=13;return{add:function(e,t){d?p.push({text:e,fn:t}):l(e,t)}}}),A("Dialog",function(e,t,n){function i(e){e=s.clone(t.id,e);var n=new a(this),i=e.cssClass;i instanceof p&&(i=i.join(" "));var f=e.buttons,d=e.eventName,h=e.prefix,g=e.suffix,m={id:l.get(h,g),articleId:l.get(h,"article-",g),contentId:l.get(h,"content-",g),footerId:l.get(h,"footer-",g),div:null,scrollable:e.scrollable,scroller:null,scrollerConfig:e.scroller,eventName:d,title:e.title,text:e.text,buttons:f,samples:u.get(e.sample),emitter:n,mask:e.mask,masker:null,layer:null,cssClass:i,style:c.get(e),autoClosed:e.autoClosed,visible:!1,volatile:e.volatile,zIndex:e["z-index"],data:{},stopHide:!1,width:e.width,height:e.height};v.set(this,m),f&&f.length>0&&f.forEach(function(e,t){var r=e.fn;if(r){var i=e.name||I(t);n.on(d,"button",i,r),n.on("button",i,r)}}),C(r).on("resize",function(){var e=o.filter(m,["width","height"]);e=c.get(e),C(m.div).css(e)})}var o=e("Object"),a=e("Emitter"),s=e("Defaults"),l=e("RandomId"),u=t.require("Sample"),c=t.require("Style"),d=t.require("Renderer"),v=e("Mapper");return i.prototype={constructor:i,$:null,render:function(){var t=v.get(this),n=t.div;if(!n){n=t.div=d.render(t,this),C(n).hide();var r=e("Mask"),i=t.zIndex;if(t.masker=new r({"z-index":i-1,volatile:t.volatile}),t.masker.on("show",function(){t.stopHide=!1}),t.volatile){var o=this;t.masker.on("hide",function(){t.stopHide?t.stopHide=!1:(t.stopHide=!0,o.hide())})}t.layer=new r({opacity:0,"z-index":i+1})}},show:function(t){var n=v.get(this),r=n.emitter;this.render(),(t=e("Mask").filter(n.mask,t))?n.masker.show(t):masker.hide(),n.layer.show({duration:200}),C(n.div).css(n.style),f(function(){C(n.div).show()},0),n.visible=!0,r&&r.fire("show")},hide:function(){var e=v.get(this),t=e.div;if(t&&e.visible){var n=e.masker;n&&(e.stopHide?e.stopHide=!1:(e.stopHide=!0,n.hide())),C(t).hide(),e.visible=!1,e.emitter.fire("hide")}},remove:function(){var e=v.get(this),t=e.div;if(t){var n=e.masker;n&&n.remove();var r=e.layer;r&&r.remove(),e.div=null,e.masker=null,e.layer=null,e.visible=!1,C(t).off(),t.parentNode.removeChild(t),e.emitter.fire("remove")}},on:function(e,t){var n=v.get(this).emitter,r=[].slice.call(arguments,0);n.on.apply(n,r)},destroy:function(){var e=v.get(this);if(!e)throw new g("该实例已给销毁，无法再次调用 destroy 方法。");var t=e.emitter,n=e.scroller;this.remove(),t.destroy(),n&&n.destroy(),v.delete(this)},set:function(e,t){var n=v.get(this),r=n.scroller;switch(this.render(),e){case"text":C("#"+n.contentId).html(t),r&&r.refresh(200);break;case"height":case"width":var i={};i[e]=n[e]=t,i=c.get(i),S.assign(n.style,i),C(n.div).css(i),r&&r.refresh(300);break;default:throw new g("目前不支持设置属性: "+e)}},data:function(e,t){var n=v.get(this).data,r=arguments.length;return 0==r?n:o.isPlain(e)?(S.assign(n,e),e):1==r?n[e]:(n[e]=t,t)}},i}),A("Dialog.defaults",{prefix:"KISP-Dialog-",suffix:4,mask:!0,autoClosed:!0,volatile:!1,title:"",text:"","z-index":1024,sample:"iOS",cssClass:"",eventName:"",width:"80%",height:"50%",buttons:[]}),A("Dialog.config",{scrollable:!1,scroller:null,eventName:"click",position:"fixed",width:600}),A("Mapper",function(e,t,n){return new w}),A("Dialog/Sample",function(e,t,n){function r(e){return e.replace(/\n|\r|\r\n/g," ").replace(/\s+/g," ")}var i=e("String");return{get:function(e){var n=t.require(e);return i.getTemplates(n,[{name:"div",begin:"#--div.begin--#",end:"#--div.end--#",fn:r},{name:"header",begin:"#--header.begin--#",end:"#--header.end--#",outer:"{header}",fn:r},{name:"footer",begin:"#--footer.begin--#",end:"#--footer.end--#",outer:"{footer}",fn:r},{name:"button",begin:"#--button.begin--#",end:"#--button.end--#",outer:"{buttons}",fn:r}])}}}),A("Dialog/Style",function(e,t,n){function r(e){var t=typeof e;return"number"==t?0-e/2+"px":"string"==t&&"px"==e.slice(-2)?0-(e=parseInt(e))/2+"px":void 0}var o=e("Style");return{get:function(e){var t=o.filter(e,["background","border","border-radius","height","width","z-index","position"]);if("width"in t){var n=t.width;if("number"!=typeof n){var a=i.documentElement.clientWidth;o.checkUnit(n,"%")?t.width=o.parsePercent(n,a):n||(t.width=.8*a+"px")}}if("height"in t){var s=t.height;if("number"!=typeof s){var l=i.documentElement.clientHeight;o.checkUnit(s,"%")?t.height=o.parsePercent(s,l):s||(t.height=.8*l+"px")}}var u=r(t.width);return u&&(t["margin-left"]=u),(u=r(t.height))&&(t["margin-top"]=u),t}}}),A("Dialog/Renderer",function(e,t,n){function r(e){if(!e)return"";var t=a.filter(e,["border-bottom","color","font-size","font-weight","width"]);return t=a.stringify(t)}var o=e("String"),a=e("Style");return{render:function(t,n){var s=t.buttons||[],l=t.emitter,u=t.id,c=t.articleId,f=t.footerId,d=t.style,p=t.samples,v=t.title;v&&"object"!=typeof v&&(v={text:v||""});var h=o.format(p.div,{id:u,"article-id":c,"content-id":t.contentId,cssClass:t.cssClass,style:a.stringify(d),text:t.text,"text-height":parseInt(d.height)-88-2,"no-header":v?"":"no-header","no-footer":s.length>0?"":"no-footer",header:function(e){return e?o.format(p.header,{style:r(e),title:e.text}):""}(v),footer:function(e){var t=e.length;return t?o.format(p.footer,{id:f,count:t,buttons:e.map(function(t,n){return"string"==typeof t&&(e[n]=t={text:t}),o.format(p.button,{index:n,text:t.text,style:r(t)})}).join("")}):""}(s)});C(i.body).prepend(h);var g=t.eventName,m=C("#"+c);if("touch"==g?m.touch(function(){l.fire("touch-main")}):m.on(g,function(){l.fire(g+"-main")}),t.scrollable){var y=new(e("Scroller"))(m.get(0),t.scrollerConfig);t.scroller=y}var w=C("#"+f);if(s.length>0){"touch"==g?w.touch("[data-index]",b,"pressed"):(w.on(g,"[data-index]",b),w.on("mousedown","[data-index]",function(e){C(this).addClass("pressed")}),w.on("mouseup mouseout","[data-index]",function(e){C(this).removeClass("pressed")}));function b(e){var r=+this.getAttribute("data-index"),i=s[r],o=i.name||I(r);l.fire("click","button",o,[i,r]),l.fire("click","button",[i,r]),l.fire("button",o,[i,r]),l.fire("button",[i,r]);var a=i.autoClosed;a===j&&(a=t.autoClosed),a&&n.hide()}}var x=i.getElementById(u);return n.$=C(x),x}}}),A("Scroller",function(e,t,n){function r(n,r){function i(){var e=d.hasHorizontalScroll,t=d.hasVerticalScroll,n=h.length;return 1==n&&(e||t)||2==n&&e&&t}a.isPlain(n)&&(n=(r=n).el),r=s.clone(t.id,r);var c=a.filter(r,["scrollbars","shrinkScrollbars","preventDefault","probeType"]),d=new(e("IScroll"))(n,c),p=l.filter(r,["top","left","right","bottom","width"]);C(n).addClass("KISP Scroller").css(p);var v=new o(this),h=d.indicators||[];h=h.map(function(e,t){return(e=C(e.indicator)).hide(),e});var g={emitter:v,scroller:d,enabled:r.enabled,indicators:h,pulldown:{},pullup:{},hasBindPull:!1,el:n};u.set(this,g),d.on("scroll",function(){this.hasVerticalScroll||this._translate(0,.5*this.distY>>0)});var m=null,y=!1;d.on("scrollStart",function(){y=!0,clearTimeout(m),i()&&h.forEach(function(e,t){e.css("opacity",1),e.show()})}),d.on("scrollEnd",function(){y=!1,m=f(function(){i()&&h.forEach(function(e,t){e.fadeOut("fast",function(){y&&(e.css("opacity",1),e.show())})})},100)}),r.enabled||this.disable()}var o=e("Emitter"),a=e("Object"),s=e("Defaults"),l=e("Style"),u=new w;return i.addEventListener("touchmove",function(e){e.preventDefault()},{passive:!1}),r.prototype={constructor:r,on:function(e,t){var n=u.get(this),r=n.emitter,i=(n.scroller,[].slice.call(arguments,0));r.on.apply(r,i)},refresh:function(t){var n=u.get(this),r=n.scroller,i=n.indicators,o=[].slice.call(arguments,1);e("Fn").delay(t,function(){r.refresh.apply(r,o),i.forEach(function(e,t){e.hide()})})},reset:function(){var e=u.get(this).scroller;e.isWaitingForManualReset=!1,e.resetPosition(e.options.bounceTime)},pulldown:function(e,n){var r=u.get(this);r.pulldown={min:e,max:n},r.hasBindPull||(t.require("pull")(r),r.hasBindPull=!0)},pullup:function(e,n){var r=u.get(this);r.pullup={min:e,max:n},r.hasBindPull||(t.require("pull")(r),r.hasBindPull=!0)},to:function(e){var t=u.get(this).scroller,n=t.options;t.scrollTo(0,e,n.bounceTime,n.bounceEasing)},toBottom:function(e){var t=u.get(this).scroller,n=t.options;e=t.maxScrollY-e,t.scrollTo(0,e,n.bounceTime,n.bounceEasing)},enable:function(){var e=u.get(this);e.enabled=!0,e.scroller.enable()},disable:function(){var e=u.get(this);e.enabled=!1,e.scroller.disable()},toggleEnable:function(e){var t=u.get(this).enabled;0==arguments.length?t?this.disable():this.enable():t&&!e?this.disable():!t&&e&&this.enable()},destroy:function(){var e=u.get(this);e.scroller.destroy(),e.emitter.destroy(),u.remove(this)},get:function(e){return u.get(this).scroller[e]},invoke:function(e,t,n){var r=u.get(this).scroller,i=[].slice.call(arguments,1);return r[e].apply(r,i)}},r}),A("IScroll",function(e,t,n){return r.IScroll||null}),A("Scroller/pull",function(e,t,n){return function(e){var t=0,n=!1,r="pulldown",i=0,o=0,a=e.emitter,s=e.scroller;s.on("scrollStart",function(){t=0;var a=this.directionY,l=this.distY;if(n=0==a?l<0:a>0,r=n?"pullup":"pulldown",this.isWaitingForManualReset=!1,n){var u=s.maxScrollY,c=e.pullup;i=c.min-u,o=c.max-u}else{var f=e.pulldown;i=f.min,o=f.max}}),s.on("scroll",function(){var e=this.y;n&&(e=-e),e<i?0==(1&t)&&(t=1,a.fire(r,"start")):i<=e&&e<o?0==(2&t)&&(t=2,a.fire(r,"enter")):e>=o&&0==(4&t)&&(t=4,a.fire(r,"reach"))}),s.on("beforeScrollEnd",function(){4==(4&t)?(this.isWaitingForManualReset=!0,a.fire(r,"release")):a.fire(r,"start")})}}),A("Alert/Sample",['<pre class="JSON">{text}</pre>'].join("\n")),A("Confirm",function(e,t,n){var r=e("Defaults"),o=e("Dialog");e("$");return{show:function(e,n){var a=r.clone(t.id),s=new o(a),l=null;n&&s.on("button","ok",n),s.on("show",function(){(l=i.activeElement).blur(),s.$.find("footer button").get(0).focus()}),s.on("hide",function(){s.destroy(),l&&l.focus(),l=null}),s.set("text",e),s.show()}}}),A("Confirm.defaults",{height:140,cssClass:"Confirm",autoClose:!0,"z-index":99999,buttons:[{text:"确定",name:"ok",color:"red"},{text:"取消"}]}),A("$",function(e,t,n){return r.jQuery||null}),A("View",function(e,t,n){function r(n,r){r=s.clone(t.id,r),r=o.remove(r,["container"]);var i=new(e("Panel"))(n,r),a=r.background;return a&&i.$.css("background",a),i}var i=e("String"),o=e("Object"),a=e("Module"),s=e("Defaults"),l=s.get(t.id);return S.assign(r,{define:function(e,t){a.define(e,function(n,o,a){var s=new r(i.format(l.container,{id:e}));return a=t(n,o,s),a=s.wrap(a)})}})}),A("View.defaults",{background:!1,container:'[data-view="{id}"]'}),A("Panel",function(e,t,n){function r(e,n){i.isPlain(e)&&(e=(n=e).container,delete n.container),n=a.clone(t.id,n);var r={emitter:new o(this),$emitter:new o,rendered:!1,show:n.show,cssClass:n.cssClass,visible:!1,byRender:!1,tpl:null,$:C(e),panel:null,this:this};c.set(this,r),this.$=r.$,r.$.on("DOMNodeRemovedFromDocument",function(){var e=r.$.selector;"string"==typeof e&&r.this.set("$",e)})}var i=e("Object"),o=e("Emitter"),a=e("Defaults"),s=e("String"),l=e("Module"),u=a.get(t.id),c=new w;return r.prototype={constructor:r,$:null,show:function(){var e=c.get(this),t=e.emitter,n=[].slice.call(arguments);e.$.show.apply(e.$,n),e.visible=!0;var r=e.byRender;e.byRender=!1,t.fire("show",[r])},hide:function(){var e=c.get(this),t=e.emitter,n=[].slice.call(arguments);e.$.hide.apply(e.$,n),e.visible=!1,t.fire("hide")},toggle:function(e){var t=c.get(this),n=t.visible;return 0==arguments.length?n?this.hide():this.show():n&&!e?this.hide():!n&&e&&this.show(),t.visible},template:function(t){var n=c.get(this),r=n.tpl;if(!r){var i=e("Template");r=n.tpl=new i(n.$)}if(t){var o=p.from(arguments);r.process.apply(r,o)}return r},fill:function(e,t){this.template();var n=c.get(this),r=n.emitter;return n.tpl.render(e,t),r.fire("fill",[e])},render:function(){var e=c.get(this),t=e.emitter,n=e.cssClass,r=p.from(arguments);e.rendered||t.fire("init",r),t.fire("before-render",r),e.$.addClass(n),t.fire("render",r),e.rendered=!0,e.show&&(e.byRender=!0,this.show()),t.fire("after-render",r)},refresh:function(){var e=c.get(this).emitter,t=[].slice.call(arguments);return e.fire("refresh",t)},close:function(){var e=c.get(this).emitter,t=[].slice.call(arguments);return e.fire("close",t)},reset:function(){var e=c.get(this).emitter,t=[].slice.call(arguments);return e.fire("reset",t)},visible:function(){return c.get(this).visible},rendered:function(){return c.get(this).rendered},destroy:function(){var e=c.get(this);e.emitter.destroy(),e.$emitter.destroy(),e.$.off(),c.delete(this)},on:function(e,t){c.get(this).emitter.on(...arguments)},off:function(e,t){c.get(this).emitter.off(...arguments)},fire:function(e,t){var n=c.get(this).$emitter,t=[].slice.call(arguments,0);return n.fire.apply(n,t)},wrap:function(e){var t=c.get(this),n=t.panel;if(n)return n;n={on:t.$emitter.on.bind(t.$emitter),off:t.$emitter.off.bind(t.$emitter)};var r=new Set(["constructor","fire","on","off","wrap"]);for(var i in this)if(!r.has(i)){var o=this[i];"function"==typeof o&&(o=o.bind(this)),n[i]=o}return n=t.panel=e?S.assign(n,e):n},propagate:function(e,t){var n=c.get(this);t.forEach(function(t){e.on(t,function(){var e=p.from(arguments);n.this.fire(t,e)})})},set:function(e,t){if(i.isPlain(e))i.each(e,function(e,t){n.this.set(e,t)});else{var n=c.get(this);switch(e){case"show":case"cssClass":case"rendered":n[e]=t;break;case"$":case"container":t=t||n.$.selector,n.$&&n.$.off(),this.$=n.$=C(t);var r=n.panel;r&&(r.$=n.$);break;default:throw new g("目前不支持设置属性: "+e)}}}},S.assign(r,{define:function(e,t){l.define(e,function(n,i,o){var a=new r(s.format(u.container,{id:e}));return o=t(n,i,a),o=a.wrap(o)})}})}),A("Panel.defaults",{container:'[data-panel="{id}"]',show:!0,cssClass:""}),A("Template",function(e,t,n){function r(e){var t=C(e).get(0);if(!t)throw e instanceof C&&(e=e.selector),new g("不存在节点: "+e);var n="template"==t.tagName.toLowerCase(),i=n?t.getAttribute("name"):"",a=(n?t.content:t).querySelectorAll("template"),u=t.innerHTML,c={},f=new s(this);a=p.from(a).map(function(e){var t=new r(e),n=t.get("name");if(c[n])throw new g("同一级下已存在名为 `"+n+"` 的模板。");c[n]=t;var i=t.get("outerHTML"),o=t.get("placeholder");return o&&(o="{"+o+"}"),u=u.replace(i,o),t.on("process",function(){var e=p.from(arguments);f.fire("process",e)}),t}),u.includes("\x3c!--")&&u.includes("--\x3e")&&(u=o.between(u,"\x3c!--","--\x3e"));var d=t.getAttribute("placeholder"),v={name:i||"",placeholder:d||"",innerHTML:t.innerHTML,outerHTML:t.outerHTML,sample:u,name$tpl:c,tpls:a,node:n?null:t,emitter:f,this:this,process:function(e){return e}};l.set(this,v),S.assign(this,{id:o.random(),meta:v})}var o=e("String"),a=e("Object"),s=e("Emitter"),l=new w;return r.prototype={constructor:r,id:"",get:function(e){return l.get(this)[e]},template:function(e){var t=this;return(p.isArray(e)?e:p.from(arguments)).map(function(e){var n=t.get("name$tpl");t=n[e]}),t},sample:function(e){return this.template(...arguments).get("sample")},render:function(e,t){t&&this.process(t);var n=l.get(this).node,r=this.fill(e);return n&&(n.innerHTML=r),r},fill:function(e){var t=p.from(arguments),n=t.findIndex(function(e){return p.isArray(e)||a.isPlain(e)});if(n>0){var r=t.slice(0,n),i=this.template(r);if(!i)throw new g("不存在路径为 "+r.join(".")+" 的模板节点，请检查 html 模板树。");u=t.slice(n);return c=i.fill(...u)}if(n<0)throw new g("填充模板时必须指定数据为一个数组或纯对象。");var s=l.get(this),u=t.slice(1);if(!p.isArray(e)){if(s.emitter.fire("process",t),"string"==typeof(e=s.process.apply(s.this,t)))return e;var c=o.format(s.sample,e);return c}return e.map(function(e,t){var n=[e,t,...u];s.emitter.fire("process",n);var r=s.process.apply(s.this,n);return"string"==typeof r?r:r?o.format(s.sample,r):""}).join("")},process:function(e){var t=l.get(this);if("function"!=typeof e){var n=p.from(arguments),r=n.findIndex(function(e){return"function"==typeof e||a.isPlain(e)});if(r<0)throw new g("模板节点 `"+t.name+"` 缺少处理器。");if(r>0){e={};var i=n.slice(0,r),o=n[r],s=r-1;i.map(function(t,n){e[t]=n<s?{}:o})}var c=t.name$tpl;a.each(e,function(e,n){if(e){var r=c[e];r?r.process(n):u.warn("不存在模板节点: `"+e+"`")}else t.process=n})}else t.process=e},fix:function(e){var t=l.get(this),n=t.sample;(e=p.isArray(e)?e:[e]).map(function(e){var t="{"+e+"}",r=t+'=""';n=n.split(r).join(t)}),t.sample=n},on:function(e,t){var n=l.get(this).emitter,r=p.from(arguments);n.on(r)},destroy:function(){var e=l.get(this);if(e){var t=e.emitter;e.tpls.map(function(e){e.destroy()}),t.destroy(),l.delete(this)}}},S.assign(r,{fill:function(e,t,n){var i=l.get(e);i||(i=new r(e),l.set(e,i)),i.render(t,n)},parse:function(e){var t=i.createElement("template");return t.innerHTML=e,t=new r(t)}})}),A("Template.defaults",{root:{begin:"\x3c!--",end:"--\x3e"},item:{begin:"#--{name}.begin--#",end:"#--{name}.end--#"},outer:64}),A("SSH.API",function(e,t,n){function r(e,n){function r(e,t,n){p.ssh=null,e=p.status=e||p.status,t=p.args=t||p.args,(n=n||p.emitter).fire("response",t),"success"==e?n.fire("code",c,t):"fail"==e&&n.fire("code",t[0],t.slice(1));var r=t.slice(-1)[0];r&&n.fire("status",r.status,t),n.fire(e,t),n.fire("done",t)}e=e||"";(n=a.clone(t.id,n)).prefix;var s=new o(this),c=n.successCode,f=n.proxy;switch(f){case!0:f=e+".js";break;case".json":case".js":f=e+f}var d=S.assign(i.filter(n,["prefix","eid","openid","serialize","timeout","appid","netid","pubacckey","timestamp","nonce","pubaccid"]),{proxy:f}),p={ajax:{name:e,successCode:c,field:n.field,data:n.data,ssh:S.assign(d,n.ssh),success:function(e,t,n){r("success",[e,t,n])},fail:function(e,t,n,i){r("fail",[e,t,n,i])},error:function(e,t,i,o){r("error",[e,t=t||n.msg,i,o])},timeout:function(e){r("timeout",[e])},abort:function(){s.fire("abort")},servers:function(e){u.fire("servers",[e])}},status:"",args:[],emitter:s,ssh:null,fireEvent:r};l.set(this,p)}var i=e("Object"),o=e("Emitter"),a=e("Defaults"),s=e("SSH"),l=(e("Fn"),e("Mapper")),u=new o(r);return r.prototype=S.assign(new s,{constructor:r,get:function(){throw new g(t.id+" 不支持 get 方式的请求")},post:function(e){var n=l.get(this),r=n.emitter,i=n.ajax,o=S.assign({},i,{data:e||i.data||{}});r.fire("request",["post",o.data]);var a=t.require("Ajax");return n.ssh=a.post(o),this},abort:function(){var e=l.get(this).ssh;e&&e.abort()}}),S.assign(r,{setServer:function(e){s.setServer(e)},on:u.on.bind(u)})}),A("SSH.API.defaults",{successCode:200,field:{code:"Result",msg:"ErrMsg",data:"Data"},proxy:null,prefix:"",timeout:0,eid:"",openid:"",appid:"",netid:"",pubacckey:"",timestamp:"",nonce:"",pubaccid:"",data:null,msg:"网络繁忙，请稍候再试"}),A("SSH",function(e,t,n){function r(e,n){function r(e,t,n){d.api=null,e=d.status=e||d.status,t=d.args=t||d.args,(n=n||d.emitter).fire("response",t),"success"==e?n.fire("code",u,t):"fail"==e&&n.fire("code",t[0],t.slice(1));var r=t.slice(-1)[0];r&&n.fire("status",r.status,t),n.fire(e,t),n.fire("done",t)}e=e||"",n=a.clone(t.id,n);var s=new o(this),u=n.successCode,c=n.proxy,f=i.filter(n,["ext","successCode","field","prefix","serialize","timeout","eid","openid","appid","netid","pubacckey","timestamp","nonce","pubaccid","data","url","form"]),d={ajax:f=S.assign(f,{name:e,proxy:c,success:function(e,t,n){r("success",[e,t,n])},fail:function(e,t,n,i){r("fail",[e,t,n,i])},error:function(e){r("error",[e])},ontimeout:function(e){r("timeout",[e])},abort:function(){s.fire("abort")}}),console:n.console,status:"",args:[],emitter:s,api:null,fireEvent:r};l.set(this,d)}var i=e("Object"),o=e("Emitter"),a=e("Defaults"),s=e("API"),l=e("Mapper");return r.prototype=S.assign(new s,{constructor:r,post:function(e){var n=l.get(this),r=n.emitter,i=n.ajax;return r.fire("request",["post",e||i.data]),t.require("Server").get({data:{eid:i.eid,appid:i.appid,netid:i.netid},success:function(r){var o=S.assign({},i,{data:e||i.data,secret:r.secret,version:r.version,fromTag:r.fromTag,url:r.url,netid:r.netid});if(i.url&&(o.url=i.url),n.console){var a="%c"+i.prefix+"%c"+i.name;u.log(a,"color:#61a7e5;","color:#138df9;",o.data)}var s=t.require("Ajax");n.api=s.post(o)},fail:function(e,t,n,o){if(302!=e){var a=i.fail;a&&a(e,t,n,o)}else{var s=n.NetIDList||[];r.fire("servers",[s,n,o])}},error:i.error}),this},abort:function(){var e=l.get(this).api;e&&e.abort()}}),S.assign(r,{setServer:function(e){t.require("Server").set(e)}})}),A("SSH.defaults",{ext:"",successCode:200,field:{code:"Result",msg:"ErrMsg",data:"DataJson"},proxy:null,prefix:"",eid:"",openid:"",appid:"",netid:"",pubacckey:"",timestamp:"",nonce:"",pubaccid:"",data:null,console:!0,timeout:0}),A("API",function(e,t,n){function r(e,n){function r(e,t,r){e=f.status=e||f.status,t=f.args=t||f.args,r=r||f.emitter,a.delay(n.delay,function(){f.xhr=null,r.fire("response",t),"success"==e?r.fire("code",u,t):"fail"==e&&r.fire("code",t[0],t);var n=t.slice(-1)[0];n&&r.fire("status",n.status,t),r.fire(e,t),r.fire("done",t)})}"object"==typeof e&&(n=e,e=""),e=e||"",n=o.clone(t.id,n);var l=new i(this),u=n.successCode,c=n.proxy;switch(c){case!0:c=e+".js";break;case".json":case".js":c=e+c}var f={ajax:{name:e,data:n.data,query:n.query,url:n.url,prefix:n.prefix,ext:n.ext,random:n.random,successCode:u,field:n.field,proxy:c,serialize:n.serialize,timeout:n.timeout,success:function(e,t,n){r("success",[e,t,n])},fail:function(e,t,n,i){r("fail",[e,t,n,i])},error:function(e){f.aborted?f.aborted=!1:r("error",[e])},ontimeout:function(e){r("timeout",[e])}},status:"",args:[],emitter:l,xhr:null,aborted:!1,fireEvent:r};s.set(this,f)}var i=e("Emitter"),o=e("Defaults"),a=e("Fn"),s=e("Mapper");return r.prototype={constructor:r,get:function(e){var n=s.get(this),r=n.emitter;n.aborted=!1;var i=S.assign({},n.ajax);e&&(i.data=e),e=i.data,r.fire("request","get",[e]),r.fire("request",["get",e]);var o=t.require("Ajax");n.xhr=o.get(i)},post:function(e,n){var r=s.get(this),i=r.emitter,o=r.ajax;r.aborted=!1;var a=S.assign({},o,{data:e||o.data,query:n||o.query});e=a.data,n=a.query,i.fire("request","post",[e,n]),i.fire("request",["post",e,n]);var l=t.require("Ajax");return r.xhr=l.post(a),this},abort:function(){var e=s.get(this),t=e.xhr;t&&(e.aborted=!0,t.abort(),e.emitter.fire("abort"))},on:function(e,t){var n=s.get(this),r=n.emitter,o=[].slice.call(arguments,0);r.on.apply(r,o);var a=n.status;if(a){var l=new i(this);l.on.apply(l,o),n.fireEvent(a,n.args,l),l.destroy()}return this},destroy:function(){s.get(this).emitter.destroy(),s.delete(this)}},r}),A("API.defaults",{successCode:200,field:{code:"code",msg:"msg",data:"data"},proxy:null,delay:!1,random:!0,url:"",prefix:"",ext:"",data:null,query:null,timeout:0,serialize:function(e,t){var n=y.stringify(t);return encodeURIComponent(n)}}),A("API/Ajax",function(e,t,n){function r(t,n){var r=n.proxy;if(r)return e("Proxy").request(r,n),null;var s=[n.url,n.prefix,n.name,n.ext].join(""),l=n.data||null;if(l){var u=n.serialize;l=i.map(l,function(e,t){return"object"==typeof t&&t?u(e,t):t})}if("post"==t){var c=n.query;c&&(s=a.add(s,c)),l&&(l=a.stringify(l))}else l&&(s=a.add(s,l),l=null);var d=n.random;d&&(d=o.random(4),s=a.add(s,d));var p=!1,v=null,h=n.timeout||0;h>0&&(v=f(function(){p=!0,g.abort();var e=n.ontimeout;e&&e(g)},h));var g=new XMLHttpRequest;return g.open(t,s,!0),g.onreadystatechange=function(){if(!p&&4==g.readyState){clearTimeout(v);var t=n.successCode,r=n.error;if(200==g.status){var i=e("JSON").parse(g.responseText);if(i){var o=n.field,a=i[o.code];if(a==t){var s=n.success,l=o.data in i?i[o.data]:{};s&&s(l,i,g)}else{var u=n.fail;u&&u(a,i[o.msg],i,g)}}else r&&r(g)}else r&&r(g)}},"post"==t&&g.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),g.send(l),g}var i=e("Object"),o=e("String"),a=e("Query");return{get:function(e){return r("get",e)},post:function(e){return r("post",e)}}}),A("SSH/Server",function(e,t,n){function r(){if(c||!1===c)return c;var n=u.cache;if("session"==n||"local"==n){var r=e("session"==n?"SessionStorage":"LocalStorage");c=new r(t.id,{name:"KISP"})}else c=!1;return c}function i(n,r,i,u,c){r=r||{url:"",secret:"",key:"",route:"",version:"",fromTag:""};var f=e("API"),p=e("MD5"),v=n.eid,g=n.netid,m=r.secret,y=a.format(new h,"yyyy-MM-dd HH:mm:ss"),w=s.random(16),b=p.encrypt(v,m,y,w),x=new f("",l.clone(t.id,{url:r.url}));x.get({EID:v,AppID:n.appid,NetID:g,AccKey:r.key,Timestamp:y,State:w,Sign:b}),x.on("success",function(e,t,n){var a=d.server={AppSecret:t.AppSecret,ServerUrl:t.ServerUrl,NetID:t.NetID||g};o(r,a,i)}),x.on("fail",function(e,t,n,r){u&&u(e,t,n)}),x.on("error",function(e){c&&c()})}function o(t,n,i){var o=e("Url"),a=n.ServerUrl||"";o.isFull(a)||(a="http://"+a);var s=n.NetID||"",l={secret:n.AppSecret,version:t.version,fromTag:t.fromTag,url:a+t.route,netid:s};f=[l];var u=r();u&&u.set("args",f),i&&i.apply(null,f)}var a=e("Date"),s=e("String"),l=e("Defaults"),u=l.get(t.id),c=null,f=null,d={config:null,server:null};return{get:function(e){var n=e.data,a=e.success,s=e.fail,l=e.error;if(u.cache&&f)a.apply(null,f);else{var c=r();c&&(f=c.get("args"))?a.apply(null,f):t.require("Config").get(function(e){if(e){d.config=e;var t=d.server;t?o(e,t,a):i(n,e,a,s,l)}else l&&l()})}},set:function(e){d.server=e;var t=d.config;t&&o(t,e)}}}),A("SSH/Server.defaults",{ext:"",successCode:200,field:{code:"Result",msg:"ErrMsg",data:"Data"},cache:"session"}),A("Date",function(e,t,n){function r(e){new h;var t=e.indexOf(".")>0?".":e.indexOf("-")>0?"-":e.indexOf("/")>0?"/":e.indexOf("_")>0?"_":null;if(!t)return null;var n=e.split(t);return{yyyy:n[0],MM:n[1]||0,dd:n[2]||1}}function i(e){var t=e.indexOf(":")>0?":":null;if(!t)return null;var n=e.split(t);return{HH:n[0]||0,mm:n[1]||0,ss:n[2]||0}}var o=0;t.exports=n={parse:function(e){var t=new h(e);if(!isNaN(t))return t;if("string"!=typeof e)return null;var n=e.split(" "),o=n[0];if(!o)return null;var a=(t=o.indexOf(":")>0?null:o)?n[1]||null:t;if(!t&&!a)return null;if(t&&a){var s=r(t),l=i(a);return new h(s.yyyy,s.MM-1,s.dd,l.HH,l.mm,l.ss)}if(t){s=r(t);return new h(s.yyyy,s.MM-1,s.dd)}if(a){var u=new h,l=i(a);return new h(u.getFullYear(),u.getMonth(),u.getDate(),l.HH,l.mm,l.ss)}},format:function(t,r){1==arguments.length?(r=t,t=new h):t=n.parse(t);for(var i=e("String"),o=t.getFullYear(),a=t.getMonth()+1,s=t.getDate(),l=t.getHours(),u=t.getMinutes(),c=t.getSeconds(),f=function(e,t){return i.padLeft(e,t,"0")},d=l<=12,p=[["yyyy",f(o,4)],["yy",I(o).slice(2)],["MM",f(a,2)],["M",a],["dddd","星期"+"日一二三四五六".charAt(t.getDay())],["dd",f(s,2)],["d",s],["HH",f(l,2)],["H",l],["hh",f(d?l:l-12,2)],["h",d?l:l-12],["mm",f(u,2)],["m",u],["ss",f(c,2)],["s",c],["tt",d?"AM":"PM"],["t",d?"A":"P"],["TT",d?"上午":"下午"],["T",d?"上":"下"]],v=r,g=i.replaceAll,m=0,y=p.length;m<y;m++){var w=p[m];v=g(v,w[0],w[1])}return v},add:function(e,t,r){var i=(e=n.parse(e)).getMilliseconds(),o=new h(e);return o.setMilliseconds(i+t),r&&(o=n.format(o,r)),o},addSeconds:function(e,t,r){return n.add(e,1e3*t,r)},addMinutes:function(e,t,r){return n.addSeconds(e,60*t,r)},addHours:function(e,t,r){return n.addMinutes(e,60*t,r)},addDays:function(e,t,r){return n.addHours(e,24*t,r)},addWeeks:function(e,t,r){return n.addDays(e,7*t,r)},addMonths:function(e,t,r){e=n.parse(e);var i=new h(e),o=e.getMonth();return i.setMonth(o+t),r&&(i=n.format(i,r)),i},addYears:function(e,t,r){return n.addMonths(e,12*t,r)},set:function(e){var t=n.parse(e);if(!t)throw new g("无法识别的日期时间格式: "+e);o=t-h.now()},get:function(e){var t=new h;return 0!=o&&(t=n.add(t,o)),e&&(t=n.format(t,e)),t},stringify:function(e){return n.format(e,"yyyy-MM-dd HH:mm:ss")}}}),A("SessionStorage",function(e,t,n){function r(e,n){var r=(n=o.clone(t.id,n)).name;if(!r)throw new g("请先配置 "+t.id+" 模块的 name 字段");var i=u[r];i||(i=u[r]={});var a={id:e,data:i[e],app:i};s.set(this,a)}var i=e("Storage"),o=e("Defaults"),a=i("session"),s=new w,l="KISP.SessionStorage.B81138B047FC",u=a.get(l)||{};return r.prototype={constructor:r,set:function(e,t){var n=s.get(this),r=n.data,i=n.app,o=n.id;r||(r=i[o]=n.data={}),"object"==typeof e?S.assign(r,e):r[e]=t,a.set(l,u)},get:function(e){var t=s.get(this).data;if(t)return 0==arguments.length?t:t[e]},remove:function(e){var t=s.get(this).data;t&&(delete t[e],a.set(l,u))},clear:function(){var e=s.get(this),t=e.id;delete e.app[t],e.data=null,a.set(l,u)}},S.assign(r,a)}),A("SessionStorage.defaults",{name:""}),A("Storage",function(e,t,n){var i={};return function(e){var t=i[e];if(t)return t;var n=e+"Storage",o=r[n];if(!o)throw new g("window 中不存在 "+n+" 存储对象。");var a="KISP."+n,s=o.getItem(a)||null;return s=y.parse(s)||{},i[e]={set:function(e,t){s[e]=t;var n=y.stringify(s);o.setItem(a,n)},get:function(e){return s[e]},remove:function(e){delete s[e];var t=y.stringify(s);o.setItem(a,t)},clear:function(){s={};var e=y.stringify(s);o.setItem(a,e)}}}}),A("LocalStorage",function(e,t,n){function r(e,n){var r=(n=o.clone(t.id,n)).name;if(!r)throw new g("请先配置 "+t.id+" 模块的 name 字段");var i=u[r];i||(i=u[r]={});var a={id:e,data:i[e],app:i};s.set(this,a)}var i=e("Storage"),o=e("Defaults"),a=i("local"),s=new w,l="KISP.LocalStorage.B81138B047FC",u=a.get(l)||{};return r.prototype={constructor:r,set:function(e,t){var n=s.get(this),r=n.data,i=n.app,o=n.id;r||(r=i[o]=n.data={}),"object"==typeof e?S.assign(r,e):r[e]=t,a.set(l,u)},get:function(e){var t=s.get(this).data;if(t)return 0==arguments.length?t:t[e]},remove:function(e){var t=s.get(this).data;t&&(delete t[e],a.set(l,u))},clear:function(){var e=s.get(this),t=e.id;delete e.app[t],e.data=null,a.set(l,u)}},S.assign(r,a)}),A("LocalStorage.defaults",{name:""}),A("MD5",function(e,t,n){function r(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n=1732584193,r=-271733879,i=-1732584194,c=271733878,f=0;f<e.length;f+=16){var d=n,v=r,h=i,g=c;r=l(r=l(r=l(r=l(r=s(r=s(r=s(r=s(r=a(r=a(r=a(r=a(r=o(r=o(r=o(r=o(r,i=o(i,c=o(c,n=o(n,r,i,c,e[f+0],7,-680876936),r,i,e[f+1],12,-389564586),n,r,e[f+2],17,606105819),c,n,e[f+3],22,-1044525330),i=o(i,c=o(c,n=o(n,r,i,c,e[f+4],7,-176418897),r,i,e[f+5],12,1200080426),n,r,e[f+6],17,-1473231341),c,n,e[f+7],22,-45705983),i=o(i,c=o(c,n=o(n,r,i,c,e[f+8],7,1770035416),r,i,e[f+9],12,-1958414417),n,r,e[f+10],17,-42063),c,n,e[f+11],22,-1990404162),i=o(i,c=o(c,n=o(n,r,i,c,e[f+12],7,1804603682),r,i,e[f+13],12,-40341101),n,r,e[f+14],17,-1502002290),c,n,e[f+15],22,1236535329),i=a(i,c=a(c,n=a(n,r,i,c,e[f+1],5,-165796510),r,i,e[f+6],9,-1069501632),n,r,e[f+11],14,643717713),c,n,e[f+0],20,-373897302),i=a(i,c=a(c,n=a(n,r,i,c,e[f+5],5,-701558691),r,i,e[f+10],9,38016083),n,r,e[f+15],14,-660478335),c,n,e[f+4],20,-405537848),i=a(i,c=a(c,n=a(n,r,i,c,e[f+9],5,568446438),r,i,e[f+14],9,-1019803690),n,r,e[f+3],14,-187363961),c,n,e[f+8],20,1163531501),i=a(i,c=a(c,n=a(n,r,i,c,e[f+13],5,-1444681467),r,i,e[f+2],9,-51403784),n,r,e[f+7],14,1735328473),c,n,e[f+12],20,-1926607734),i=s(i,c=s(c,n=s(n,r,i,c,e[f+5],4,-378558),r,i,e[f+8],11,-2022574463),n,r,e[f+11],16,1839030562),c,n,e[f+14],23,-35309556),i=s(i,c=s(c,n=s(n,r,i,c,e[f+1],4,-1530992060),r,i,e[f+4],11,1272893353),n,r,e[f+7],16,-155497632),c,n,e[f+10],23,-1094730640),i=s(i,c=s(c,n=s(n,r,i,c,e[f+13],4,681279174),r,i,e[f+0],11,-358537222),n,r,e[f+3],16,-722521979),c,n,e[f+6],23,76029189),i=s(i,c=s(c,n=s(n,r,i,c,e[f+9],4,-640364487),r,i,e[f+12],11,-421815835),n,r,e[f+15],16,530742520),c,n,e[f+2],23,-995338651),i=l(i,c=l(c,n=l(n,r,i,c,e[f+0],6,-198630844),r,i,e[f+7],10,1126891415),n,r,e[f+14],15,-1416354905),c,n,e[f+5],21,-57434055),i=l(i,c=l(c,n=l(n,r,i,c,e[f+12],6,1700485571),r,i,e[f+3],10,-1894986606),n,r,e[f+10],15,-1051523),c,n,e[f+1],21,-2054922799),i=l(i,c=l(c,n=l(n,r,i,c,e[f+8],6,1873313359),r,i,e[f+15],10,-30611744),n,r,e[f+6],15,-1560198380),c,n,e[f+13],21,1309151649),i=l(i,c=l(c,n=l(n,r,i,c,e[f+4],6,-145523070),r,i,e[f+11],10,-1120210379),n,r,e[f+2],15,718787259),c,n,e[f+9],21,-343485551),n=u(n,d),r=u(r,v),i=u(i,h),c=u(c,g)}return p(n,r,i,c)}function i(e,t,n,r,i,o){return u(c(u(u(t,e),u(r,o)),i),n)}function o(e,t,n,r,o,a,s){return i(t&n|~t&r,e,t,o,a,s)}function a(e,t,n,r,o,a,s){return i(t&r|n&~r,e,t,o,a,s)}function s(e,t,n,r,o,a,s){return i(t^n^r,e,t,o,a,s)}function l(e,t,n,r,o,a,s){return i(n^(t|~r),e,t,o,a,s)}function u(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function c(e,t){return e<<t|e>>>32-t}function f(e){for(var t=p(),n=(1<<h)-1,r=0;r<e.length*h;r+=h)t[r>>5]|=(e.charCodeAt(r/h)&n)<<r%32;return t}function d(e){for(var t=v?"0123456789ABCDEF":"0123456789abcdef",n="",r=0;r<4*e.length;r++)n+=t.charAt(e[r>>2]>>r%4*8+4&15)+t.charAt(e[r>>2]>>r%4*8&15);return n}var v=0,h=8;return{encrypt:function(e){return arguments.length>1&&(e=[].slice.call(arguments).join("")),d(r(f(e),e.length*h))}}}),A("SSH/Server/Config",function(e,t,n){function r(){if(null!==s)return s;var n=o.get(t.id).cache;if("session"==n||"local"==n){var r=e("session"==n?"SessionStorage":"LocalStorage");return s=new r(t.id,{name:"KISP"})}return s=!1}function i(e){var n=o.get(t.id),i=n.url;C.getJSON(i,function(t){try{var i=n.host||t.kisplusServerS,o=t.kisplusAppsecret;a={version:t.ver,fromTag:t.fromtag,key:t.AccKey,secret:t.AccSecret,host:i,path:o,route:t.kisplusApiRouter,url:i+o};var s=r();s&&s.set(a)}catch(e){a=null}e&&e(a),n.cache||(a=null)})}e("Emitter");var o=e("Defaults"),a=null,s=null;return{get:function(e){if(o.get(t.id).cache&&a)e(a);else{var n=r();n&&(a=n.get())?e(a):i(e)}}}}),A("SSH/Server/Config.defaults",{url:"http://mob.cmcloud.cn/kisplus/kisplusconfig.aspx?callback=?",cache:"session",host:""}),A("SSH/Ajax",function(e,t,n){var r=e("Object"),i=e("Date"),o=e("String"),a=e("Query");return{post:function(t){var n=e("MD5"),s=t.prefix+t.name,l=t.eid,u=t.openid,c=i.get("yyyy-MM-dd HH:mm:ss"),f=o.random(16),d=t.form||{},p=d.secret||t.secret;d.Openid=d.Openid||u;var v={EID:l,Openid:u,Method:s,Timestamp:c,Ver:t.version,FromTag:t.fromTag,AppID:t.appid,NetID:t.netid,IsNewJson:"Y",IsEncrypt:"N",Sign:n.encrypt(l,p,s,c,f),State:f,CustData:t.data};S.assign(v,d),delete v.secret;var h={},g=e("API"),m=r.filter(t,["ext","successCode","field","url","proxy","serialize","timeout"]);m.url=a.add(m.url,s);var y=new g("",m),w=r.filter(t,["success","fail","error","abort"]);return w.timeout=t.ontimeout,y.on(w),y.post(v,h),y}}}),A("SSH.API/Ajax",function(e,t,n){var r=e("Object");return{post:function(t){var n=new(e("SSH"))(t.name,t.ssh),i=t.success,o=t.fail,a=t.error,s=t.field;n.on({success:function(e,n,r){e||a&&a(r);var l=t.successCode,u=e[s.code];u==l?i&&i(e[s.data]||{},e,r):o&&o(u,e[s.msg],e,r)},fail:function(e,t,n,r){a&&a(e,t,n,r)},error:function(e){a&&a(j,j,j,e)},timeout:t.timeout,abort:t.abort,servers:t.servers});var l=t.data;return n.post({openid:t.ssh.openid,Result:"",ErrMsg:"",AccountDB:"",TotalPage:"",CurrentPage:l.pageNo,ItemsOfPage:l.pageSize,Data:r.remove(l,["pageNo","pageSize"])}),n}}}),A("Toast",function(e,t,n){function r(e){e=a.clone(t.id,e);var n=new o(this),r=e.cssClass;r instanceof p&&(r=r.join(" "));var i=e.text;r+=i||0===i?" HasText":" NoText";var l=e.icon;r+=l?" HasIcon":" NoIcon";var f=e.prefix,v=e.suffix,h={id:s.get(f,v),icon:l,iconId:s.get(f,"icon-",v),textId:s.get(f,"text-",v),div:null,sample:u.get(e.sample),text:i,emitter:n,mask:e.mask,masker:null,style:c.get(e),showTime:0,cssClass:r,duration:e.duration,container:e.container,append:e.append};d.set(this,h)}var o=e("Emitter"),a=e("Defaults"),s=e("RandomId"),l=t.require("Renderer"),u=t.require("Sample"),c=t.require("Style"),d=new w;return r.prototype={constructor:r,show:function(t,n){"object"==typeof t&&(t=(n=t).text),n=n||{};var r=d.get(this),i=r.div,o=c.get(r.style,n);i||(i=l.render(r,o)),C(i).css(o);var a=e("Mask"),s=a.filter(r.mask,n.mask),u=r.masker;if(s?(u||(u=new a,r.masker=u),u.show(s)):u&&u.hide(),t!==j&&t!=r.text&&(C("#"+r.textId).html(t),r.text=t,C(i).removeClass("NoText").addClass("HasText")),"icon"in n){var p=n.icon;p?(C(i).removeClass("NoIcon").addClass("HasIcon"),p!=r.icon&&(C("#"+r.iconId).removeClass("fa-"+r.icon).addClass("fa-"+p),r.icon=p)):C(i).removeClass("HasIcon").addClass("NoIcon")}r.showTime=new h,C(i).show(),r.emitter.fire("show");var v="duration"in n?n.duration:r.duration;if(v){var g=this;f(function(){g.hide()},v)}},hide:function(e){function t(){var e=n.masker;e&&e.hide(),n.showTime=0,C(r).hide(),n.emitter.fire("hide")}var n=d.get(this),r=n.div;if(r)if(e){var i=e-(new h-n.showTime);i>0?f(t,i):t()}else t()},remove:function(){var e=d.get(this),t=e.div;if(t){var n=e.masker;n&&n.remove(),e.div=null,e.masker=null,e.hasBind=!1,C(t).off(),i.body.removeChild(t),e.emitter.fire("remove")}},on:function(e,t){var n=d.get(this).emitter,r=[].slice.call(arguments,0);n.on.apply(n,r)},destroy:function(){var e=d.get(this).emitter;this.remove(),e.destroy(),d.remove(this)}},r}),A("Toast.defaults",{prefix:"KISP-Toast-",suffix:4,text:"",container:i.body,append:!1,mask:!1,sample:"font-awesome",cssClass:"",icon:"check",duration:0}),A("Toast/Renderer",function(e,t,n){var r=e("String");return{render:function(t,n){var o=e("Style"),a=t.id,s=t.sample,l=r.format(s,{id:a,icon:t.icon,"icon-id":t.iconId,"text-id":t.textId,text:t.text,style:o.stringify(n),cssClass:t.cssClass}),u=t.container;t.append?C(u).append(l):C(u).prepend(l);var c=i.getElementById(a);return t.div=c,c}}}),A("Toast/Sample",function(e,t,n){var r={};return{get:function(e){var n=r[e];return n||(n=t.require(e),r[e]=n,n)}}}),A("Toast/Style",function(e,t,n){function r(e){var t=typeof e;return"number"==t?0-e/2+"px":"string"==t&&"px"==e.slice(-2)?0-(e=parseInt(e))/2+"px":void 0}var i=e("Style");return{get:function(e,t,n){var o=[].slice.call(arguments),a=i.filter(o,["background","border-radius","bottom","color","font-size","height","left","margin-top","right","top","width","z-index","position"]),s=r(a.width);return s&&(a["margin-left"]=s),(s=r(a.height))&&(a["margin-top"]=s),a}}}),A("CloudHome",function(e,t,n){var i=e("Query"),o=t.require("Native");t.exports={invoke:o.invoke,check:function(e){if(e){var t=/Qing\/.*;(iPhone|Android).*/;return!!a.userAgent.match(t)}return!!i.has(r,"ticket")},close:function(){o.invoke("close")},shareWechat:function(t){var n=new(e("CloudHome.API"))("socialShare"),r=t.success;r&&n.on("success",r);var i=t.fail;i&&n.on("fail",i),n.invoke({shareWay:"wechat",shareType:3,shareContent:{title:t.title,description:t.content,thumbData:t.icon,webpageUrl:t.url}})},setTitle:function(t){var n=e("CloudHome.Title");!0===t?n.show():!1===t?n.hide():t||""===t?n.set(t):n.show()}}}),A("CloudHome.API",function(e,t,n){function r(e,n){e=e||"",n=o.clone(t.id,n);var r=new i(this),l=n.delay,u={name:e,field:n.field,status:"",args:[],emitter:r,fireEvent:function(e,t,n){e=u.status=e||u.status,t=u.args=t||u.args,n=n||u.emitter,a.delay(l,function(){"fail"==e&&n.fire("code",t[0],t),n.fire(e,t),n.fire("done",t)})}};s.set(this,u)}var i=e("Emitter"),o=e("Defaults"),a=e("Fn"),s=new w;return r.prototype={constructor:r,invoke:function(t){var n=s.get(this),r=n.name,i=n.field;return e("CloudHome").invoke(r,t,function(e){var t=e[i.success];if(t="true"==I(t).toLowerCase()){var r=e[i.data]||{};n.fireEvent("success",[r,e])}else{var o=e[i.code],a=e[i.msg];n.fireEvent("fail",[o,a,e])}}),this},on:function(e,t){var n=s.get(this),r=n.emitter,o=[].slice.call(arguments,0);r.on.apply(r,o);var a=n.status;if(a){var l=new i(this);l.on.apply(l,o),n.fireEvent(a,n.args,l),l.destroy()}return this},off:function(e,t){var n=s.get(this).emitter,r=[].slice.call(arguments,0);return n.off.apply(n,r),this},destroy:function(){s.get(this).emitter.destroy(),s.remove(this)}},r}),A("CloudHome.API.defaults",{field:{success:"success",code:"errorCode",msg:"error",data:"data"},delay:!1}),A("CloudHome.Title",function(e,t,n){var r=i.title,o=!1;t.exports=n={set:function(t){r=t,i.title=t,e("CloudHome").invoke("setWebViewTitle",{title:t}),o=!0},show:function(){n.set(r)},hide:function(){r=i.title,e("CloudHome").invoke("hideWebViewTitle"),o=!1},toggle:function(e){e?n.show():n.hide()}}}),A("CloudHome/Native",function(e,t,n){var o=0,a={};return r.XuntongJSBridge={handleMessageFromXT:function(e,t){var n=a[e];n&&n(t||{})}},{invoke:function(e,t,n){"function"==typeof t&&(n=t,t=null),t=y.stringify(t||{}),t=encodeURIComponent(t);var r=n?++o:0;r&&(a[r]=n);var s=["xuntong",e,r,t].join(":"),l=i.createElement("iframe");l.setAttribute("height","1px"),l.setAttribute("width","1px"),l.setAttribute("src",s),i.documentElement.appendChild(l),l.parentNode.removeChild(l),l=null}}}),A("Tabs",function(e,t,n){function r(e,n){o.isPlain(e)&&(e=(n=e).container),n=a.clone(t.id,n);var r={emitter:new i(this),container:e,activedIndex:-1,activedNode:null,activedClass:n.activedClass,pressedClass:n.pressedClass,repeated:n.repeated,looped:n.looped,eventName:n.eventName,list:[],indexKey:n.field.index,eventKey:n.field.event,nodes:null,selector:n.selector,change:null,old:null,tpl:null};l.set(this,r);var s=n.list;s&&this.render(s);var u=n.current;"number"==typeof u&&this.active(u);var c=n.change;c&&this.on("change",c)}var i=e("Emitter"),o=e("Object"),a=e("Defaults"),s=t.require("Helper"),l=new w;return r.prototype={constructor:r,template:function(t){var n=l.get(this),r=n.tpl;if(!r){var i=e("Template"),o=n.container;r=n.tpl=new i(o)}if(t){var a=p.from(arguments);r.process.apply(r,a)}},render:function(e,t){var n=l.get(this),r=n.container;if(e&&(this.template(),n.tpl.render(e,t),n.list=e,n.nodes=null,n.activedNode=null,n.activedIndex=-1),!n.change){var i=n.eventName,o=n.selector,a=(n.pressedClass,this),u=n.change=function(e){var t=s.getIndex(n,this);a.active(t)};C(r).on(i,o,u)}},active:function(e,t){var n=l.get(this),r=n.list;"number"!=typeof e&&(e=s.findIndex(r,e,arguments[1]));var i=n.activedIndex,o=e==i;if(!o||n.repeated){var a=n.activedNode;if(!o){i=n.activedIndex=e;var u=n.activedClass;a&&C(a).removeClass(u),a=n.activedNode=s.getNode(n,e),C(a).addClass(u)}var c=n.emitter,f=r[e],d={item:f,index:e,element:a},p=n.old;if(n.old=d,!t){var v=[f,e,d,p];c.fire("before-change",v),c.fire("change",e,v);var h=n.eventKey;h&&c.fire("change",I(f[h]),v),c.fire("change",v)}}},previous:function(e){var t=l.get(this),n=t.list,r=t.looped,i=t.activedIndex;if(0==i){if(!r)return;i=n.length}this.active(i-1,e)},next:function(e){var t=l.get(this),n=t.list,r=t.looped,i=t.activedIndex;if(i==n.length-1){if(!r)return;i=-1}this.active(i+1,e)},show:function(e){var t=l.get(this).container;C(t).show()},hide:function(e){var t=l.get(this).container;C(t).hide()},on:function(e,t){var n=l.get(this).emitter,r=[].slice.call(arguments,0);n.on.apply(n,r)},destroy:function(){var e=l.get(this);e.emitter.destroy();var t=e.container,n=e.eventName,r=e.selector,i=e.change;C(t).off(n,r,i),l.delete(this)},getActivedIndex:function(){return l.get(this).activedIndex},reset:function(){var e=l.get(this);C(e.container).find(e.selector).removeClass(e.activedClass),e.activedIndex=-1},remove:function(e){var t=l.get(this),n=t.activedIndex;e!=n?(t.list.splice(e,1),e<n&&n--,this.active(n,!1)):this.reset()}},r}),A("Tabs.defaults",{current:null,pressedClass:"",activedClass:"",eventName:"",selector:">*",repeated:!1,looped:!1,field:{index:"data-index",event:""}}),A("Tabs.config",{eventName:"click"}),A("Tabs/Helper",function(e,t,n){function r(e){return e.nodes=C(e.container).find(e.selector).toArray()}return{getIndex:function(e,t){var n=e.indexKey,i=t.getAttribute(n);return i?+i:r(e).findIndex(function(e,n){return e===t})},getNode:function(e,t){return r(e)[t]},findIndex:function(e,t,n){var r=typeof t;if("object"==r)return e.findIndex(function(e,n){return t===e});if("string"==r)return e.findIndex(function(e,r){return e[t]===n});if("function"==r)return e.findIndex(e,t);throw new g("无法识别的参数 key: "+r)}}}),A("NoData",function(e,t,n){function r(e,n){C.Object.isPlain(e)?n=e:n.container=e;var r=(n=a.clone(t.id,n)).cssClass;r instanceof p&&(r=r.join(" "));var s=n.prefix,f=n.suffix,d={div:null,top:n.top,bottom:n.bottom,icon:n.icon,text:n.text,emitter:new i(this),container:n.container,append:n.append,id:o.get(s,f),textId:o.get(s,"text-",f),text:n.text,cssClass:r,sample:l,style:u.get(n),scrollable:n.scrollable,pulldown:n.pulldown,visible:!1};c.set(this,d)}e("Object");var i=e("Emitter"),o=e("RandomId"),a=e("Defaults"),s=t.require("Renderer"),l=t.require("Sample"),u=t.require("Style"),c=new w;return r.prototype={constructor:r,show:function(e){var t=c.get(this),n=t.div;n?C("#"+t.textId).html(e||t.text):n=s.render(t,{text:e}),t.visible=!0,C(n).show(),t.emitter.fire("show")},hide:function(){var e=c.get(this),t=e.div;t&&(e.visible=!1,C(t).hide(),e.emitter.fire("hide"))},toggle:function(e){e instanceof p&&(e=0==e.length);var t=c.get(this).visible;0==arguments.length?t?this.hide():this.show():t&&!e?this.hide():!t&&e&&this.show()},on:function(e,t){var n=c.get(this),r=n.emitter,i=(n.scroller,[].slice.call(arguments,0));r.on.apply(r,i)},destroy:function(){var e=c.get(this);e.scroller.destroy(),e.emitter.destroy(),c.remove(this)}},r}),A("NoData.defaults",{prefix:"KISP-NoData-",suffix:4,text:"暂无数据",cssClass:"",container:i.body,append:!1,scrollable:!0,pulldown:null}),A("NoData/Renderer",function(e,t,n){var r=e("String"),o=e("Style");return{render:function(t,n){var a=t.id,s=t.sample,l=t.style,u=n.text||t.text,c=r.format(s,{id:a,"text-id":t.textId,text:u,style:o.stringify(l),cssClass:t.cssClass}),f=t.container;t.append?C(f).append(c):C(f).prepend(c);var d=i.getElementById(a);if(t.div=d,t.scrollable){var p=new(e("Scroller"))(d,{top:t.top,bottom:t.bottom}),v=t.pulldown;v&&p.pulldown(v)}return d}}}),A("NoData/Sample",['<div id="{id}" class="KISP NoData {cssClass}" style="{style}">',"    <ul>",'        <li class="Icon"></li>','        <li id="{text-id}" class="Text">{text}</li>',"    </ul>","</div>","",""].join("\n")),A("NoData/Style",function(e,t,n){var r=e("Style");return{get:function(e,t,n){var i=[].slice.call(arguments);return r.filter(i,["background","bottom","color","font-size","top","z-index"])}}}),A("ImageReader",function(e,t,n){function r(e,n){i.isPlain(e)&&(e=(n=e).el,delete n.el),n=a.clone(t.id,n);var r={emitter:new o(this),input:e,loading:n.loading};l.set(this,r)}var i=e("Object"),o=e("Emitter"),a=e("Defaults"),s=t.require("Renderer"),l=new w;return r.prototype={constructor:r,render:function(e){var t=l.get(this);s.render(t,e)},on:function(e,t){var n=l.get(this).emitter,r=[].slice.call(arguments,0);n.on.apply(n,r)}},r}),A("ImageReader.defaults",{loading:"读取中..."}),A("ImageReader/Renderer",function(e,t,n){function r(e){var t=e.emitter,n=e.loading;!0===n?n=KISP.create("Loading",{text:"读取中..."}):"string"==typeof n&&(n=KISP.create("Loading",{text:n})),C(e.input).on("change",function(e){var r=this.files[0];if(r)if(0==r.type.indexOf("image/")){var i=new FileReader;i.onload=function(e){n&&n.hide();var r=e.target.result;t.fire("success",[r])},n&&n.show(),i.readAsDataURL(r)}else t.fire("fail",[201,"所选择的文件类型不是图片",{img:r}]);else t.fire("cancel")})}function i(t,n){var r=t.emitter;C(t.input).on("click",function(t){t.preventDefault();var i=new(e("CloudHome.API"))("selectPic");i.on("success",function(e,t){var n,i;try{n=e.fileExt,i=e.fileData.replace(/[\r\n]/g,"")}catch(e){var o="无法读取图片，云之家接口有问题: "+e.message;return void r.fire("fail",[500,o,t])}var a="data:image/"+n+";base64,"+i;r.fire("success",[a])}),i.on("fail",function(e,t,n){1!=e?r.fire("fail",[e,t,n]):r.fire("cancel")}),i.invoke(n)})}var o;return{render:function(t,n){if(o===j){var a=e("CloudHome");o=a.check()}o?i(t,n):r(t)}}}),A("Escape",function(e,t,n){t.exports=n={html:function(e){var t=I(e),n=/[&'"<>\/\\\-\x00-\x09\x0b-\x0c\x1f\x80-\xff]/g;return t=t.replace(n,function(e){return"&#"+e.charCodeAt(0)+";"}),t=t.replace(/ /g,"&nbsp;"),t=t.replace(/\r\n/g,"<br />"),t=t.replace(/\n/g,"<br />"),t=t.replace(/\r/g,"<br />")},attribute:function(e){var t=/[&'"<>\/\\\-\x00-\x1f\x80-\xff]/g;return I(e).replace(t,function(e){return"&#"+e.charCodeAt(0)+";"})},script:function(e){var t=I(e),n=/[\\"']/g;return t=t.replace(n,function(e){return"\\"+e}),t=t.replace(/%/g,"\\x25"),t=t.replace(/\n/g,"\\n"),t=t.replace(/\r/g,"\\r"),t=t.replace(/\x01/g,"\\x01")},query:function(e){var t=I(e);return escape(t).replace(/\+/g,"%2B")},hrefScript:function(e){var t=n.escapeScript(e);return t=t.replace(/%/g,"%25"),t=n.escapeElementAttribute(t)},regexp:function(e){var t=/[\\\^\$\*\+\?\{\}\.\(\)\[\]]/g;return I(e).replace(t,function(e,t){return"\\"+e})}}}),A("NumberPad/Sample",["",'<div id="{id}" class="KISP NumberPad {cssClass}" style="{style}">','    <ul id="{header-id}" class="header {has-text}">','        <li id="{text-id}" class="text">{text}</li>','        <li id="{value-id}" class="value">{value}</li>','        <li class="ok">','            <span data-cmd="done">完成</span>',"        </li>","    </ul>",'    <div class="main">',"        <ul>",'            <li><span data-key="1">1</span></li>','            <li><span data-key="2">2</span></li>','            <li><span data-key="3">3</span></li>',"        </ul>","        <ul>",'            <li><span data-key="4">4</span></li>','            <li><span data-key="5">5</span></li>','            <li><span data-key="6">6</span></li>',"        </ul>","        <ul>",'            <li><span data-key="7">7</span></li>','            <li><span data-key="8">8</span></li>','            <li><span data-key="9">9</span></li>',"        </ul>",'        <ul id="{footer-id}" class="special {no-point}">','            <li class="key-point"><span data-key=".">.</span></li>','            <li><span data-key="0" class="zero">0</span></li>','            <li><span data-cmd="back" class="icon-back"></span></li>',"        </ul>","    </div>","</div>"].join("\n")),A("Dialog/Sample/iOS",["#--div.begin--#",'<div id="{id}" class="KISP Dialog {cssClass}" style="{style}">',"","    #--header.begin--#",'    <header style="{style}">',"        {title}","    </header>","    #--header.end--#","",'    <article id="{article-id}" class="{no-header} {no-footer}">','        <div id="{content-id}">{text}</div>',"    </article>","","    #--footer.begin--#",'    <footer id="{id}" class="buttons-{count}">',"        #--button.begin--#",'        <button data-index="{index}" style="{style}">{text}</button>',"        #--button.end--#","    </footer>","    #--footer.end--#","</div>","#--div.end--#"].join("\n")),A("Loading/Sample/iOS",['<div id="{id}" class="KISP Loading-iOS {cssClass}" style="{style}">','    <div class="Main">','        <div class="Item-0"></div>','        <div class="Item-1"></div>','        <div class="Item-2"></div>','        <div class="Item-3"></div>','        <div class="Item-4"></div>','        <div class="Item-5"></div>','        <div class="Item-6"></div>','        <div class="Item-7"></div>','        <div class="Item-8"></div>','        <div class="Item-9"></div>','        <div class="Item-10"></div>','        <div class="Item-11"></div>',"    </div>",'    <span id="{text-id}" class="Text">{text}</span>',"</div>"].join("\n")),A("Toast/Sample/font-awesome",['<div id="{id}" class="KISP Toast-font-awesome {cssClass}">',"    <div>",'        <i id="{icon-id}" class="fa fa-{icon}"></i>',"    </div>",'    <span id="{text-id}" class="Text">{text}</span>',"</div>"].join("\n")),function(t){var n=t("KISP"),r=t("Module");e.KISP=n,e.define=r.define}(E.require)}(window,top,parent,window,document,location,navigator,localStorage,sessionStorage,console,history,setTimeout,setInterval,Array,Boolean,Date,Error,Function,JSON,Map,Math,Number,Object,RegExp,String,window.jQuery,void 0);